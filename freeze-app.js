/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function e(e,t,s,r){var n,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,s,o):n(t,s))||o);return i>3&&o&&Object.defineProperty(t,s,o),o
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const t=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),r=new Map;class n{constructor(e,t){if(this._$cssResult$=!0,t!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){let e=r.get(this.cssText);return t&&void 0===e&&(r.set(this.cssText,e=new CSSStyleSheet),e.replaceSync(this.cssText)),e}toString(){return this.cssText}}const i=t?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return(e=>new n("string"==typeof e?e:e+"",s))(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var o,a;const c={toAttribute(e,t){switch(t){case Boolean:e=e?"":null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},l=(e,t)=>t!==e&&(t==t||e==e),d={attribute:!0,type:String,converter:c,reflect:!1,hasChanged:l};class h extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(e){var t;null!==(t=this.l)&&void 0!==t||(this.l=[]),this.l.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,s)=>{const r=this._$Eh(s,t);void 0!==r&&(this._$Eu.set(r,s),e.push(r))})),e}static createProperty(e,t=d){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const s="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,s,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(r){const n=this[e];this[t]=r,this.requestUpdate(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||d}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const s of t)this.createProperty(s,e[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(i(e))}else void 0!==e&&t.push(i(e));return t}static _$Eh(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}o(){var e;this._$Ev=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Ep(),this.requestUpdate(),null===(e=this.constructor.l)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,s;(null!==(t=this._$Em)&&void 0!==t?t:this._$Em=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(s=e.hostConnected)||void 0===s||s.call(e))}removeController(e){var t;null===(t=this._$Em)||void 0===t||t.splice(this._$Em.indexOf(e)>>>0,1)}_$Ep(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Et.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const s=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,s)=>{t?e.adoptedStyleSheets=s.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):s.forEach((t=>{const s=document.createElement("style"),r=window.litNonce;void 0!==r&&s.setAttribute("nonce",r),s.textContent=t.cssText,e.appendChild(s)}))})(s,this.constructor.elementStyles),s}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$Em)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$Em)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$Eg(e,t,s=d){var r,n;const i=this.constructor._$Eh(e,s);if(void 0!==i&&!0===s.reflect){const o=(null!==(n=null===(r=s.converter)||void 0===r?void 0:r.toAttribute)&&void 0!==n?n:c.toAttribute)(t,s.type);this._$Ei=e,null==o?this.removeAttribute(i):this.setAttribute(i,o),this._$Ei=null}}_$AK(e,t){var s,r,n;const i=this.constructor,o=i._$Eu.get(e);if(void 0!==o&&this._$Ei!==o){const e=i.getPropertyOptions(o),a=e.converter,l=null!==(n=null!==(r=null===(s=a)||void 0===s?void 0:s.fromAttribute)&&void 0!==r?r:"function"==typeof a?a:null)&&void 0!==n?n:c.fromAttribute;this._$Ei=o,this[o]=l(t,e.type),this._$Ei=null}}requestUpdate(e,t,s){let r=!0;void 0!==e&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||l)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===s.reflect&&this._$Ei!==e&&(void 0===this._$ES&&(this._$ES=new Map),this._$ES.set(e,s))):r=!1),!this.isUpdatePending&&r&&(this._$Ev=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ev}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((e,t)=>this[t]=e)),this._$Et=void 0);let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),null===(e=this._$Em)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(s)):this._$ET()}catch(e){throw t=!1,this._$ET(),e}t&&this._$AE(s)}willUpdate(e){}_$AE(e){var t;null===(t=this._$Em)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ev}shouldUpdate(e){return!0}update(e){void 0!==this._$ES&&(this._$ES.forEach(((e,t)=>this._$Eg(t,this[t],e))),this._$ES=void 0),this._$ET()}updated(e){}firstUpdated(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var u,p;h.finalized=!0,h.elementProperties=new Map,h.elementStyles=[],h.shadowRootOptions={mode:"open"},null===(o=globalThis.reactiveElementPolyfillSupport)||void 0===o||o.call(globalThis,{ReactiveElement:h}),(null!==(a=globalThis.reactiveElementVersions)&&void 0!==a?a:globalThis.reactiveElementVersions=[]).push("1.0.0");const m=globalThis.trustedTypes,f=m?m.createPolicy("lit-html",{createHTML:e=>e}):void 0,v=`lit$${(Math.random()+"").slice(9)}$`,g="?"+v,y=`<${g}>`,w=document,_=(e="")=>w.createComment(e),$=e=>null===e||"object"!=typeof e&&"function"!=typeof e,b=Array.isArray,x=e=>{var t;return b(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])},A=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,S=/-->/g,k=/>/g,C=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,E=/'/g,R=/"/g,M=/^(?:script|style|textarea)$/i,D=(e=>(t,...s)=>({_$litType$:e,strings:t,values:s}))(1),P=Symbol.for("lit-noChange"),L=Symbol.for("lit-nothing"),N=new WeakMap,I=w.createTreeWalker(w,129,null,!1),U=(e,t)=>{const s=e.length-1,r=[];let n,i=2===t?"<svg>":"",o=A;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===A?"!--"===c[1]?o=S:void 0!==c[1]?o=k:void 0!==c[2]?(M.test(c[2])&&(n=RegExp("</"+c[2],"g")),o=C):void 0!==c[3]&&(o=C):o===C?">"===c[0]?(o=null!=n?n:A,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?C:'"'===c[3]?R:E):o===R||o===E?o=C:o===S||o===k?o=A:(o=C,n=void 0);const h=o===C&&e[t+1].startsWith("/>")?" ":"";i+=o===A?s+y:l>=0?(r.push(a),s.slice(0,l)+"$lit$"+s.slice(l)+v+h):s+v+(-2===l?(r.push(void 0),t):h)}const a=i+(e[s]||"<?>")+(2===t?"</svg>":"");return[void 0!==f?f.createHTML(a):a,r]};class O{constructor({strings:e,_$litType$:t},s){let r;this.parts=[];let n=0,i=0;const o=e.length-1,a=this.parts,[c,l]=U(e,t);if(this.el=O.createElement(c,s),I.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(r=I.nextNode())&&a.length<o;){if(1===r.nodeType){if(r.hasAttributes()){const e=[];for(const t of r.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(v)){const s=l[i++];if(e.push(t),void 0!==s){const e=r.getAttribute(s.toLowerCase()+"$lit$").split(v),t=/([.?@])?(.*)/.exec(s);a.push({type:1,index:n,name:t[2],strings:e,ctor:"."===t[1]?H:"?"===t[1]?F:"@"===t[1]?W:j})}else a.push({type:6,index:n})}for(const t of e)r.removeAttribute(t)}if(M.test(r.tagName)){const e=r.textContent.split(v),t=e.length-1;if(t>0){r.textContent=m?m.emptyScript:"";for(let s=0;s<t;s++)r.append(e[s],_()),I.nextNode(),a.push({type:2,index:++n});r.append(e[t],_())}}}else if(8===r.nodeType)if(r.data===g)a.push({type:2,index:n});else{let e=-1;for(;-1!==(e=r.data.indexOf(v,e+1));)a.push({type:7,index:n}),e+=v.length-1}n++}}static createElement(e,t){const s=w.createElement("template");return s.innerHTML=e,s}}function z(e,t,s=e,r){var n,i,o,a;if(t===P)return t;let c=void 0!==r?null===(n=s._$Cl)||void 0===n?void 0:n[r]:s._$Cu;const l=$(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(i=null==c?void 0:c._$AO)||void 0===i||i.call(c,!1),void 0===l?c=void 0:(c=new l(e),c._$AT(e,s,r)),void 0!==r?(null!==(o=(a=s)._$Cl)&&void 0!==o?o:a._$Cl=[])[r]=c:s._$Cu=c),void 0!==c&&(t=z(e,c._$AS(e,t.values),c,r)),t}class T{constructor(e,t){this.v=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(e){var t;const{el:{content:s},parts:r}=this._$AD,n=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:w).importNode(s,!0);I.currentNode=n;let i=I.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new B(i,i.nextSibling,this,e):1===c.type?t=new c.ctor(i,c.name,c.strings,this,e):6===c.type&&(t=new q(i,this,e)),this.v.push(t),c=r[++a]}o!==(null==c?void 0:c.index)&&(i=I.nextNode(),o++)}return n}m(e){let t=0;for(const s of this.v)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class B{constructor(e,t,s,r){var n;this.type=2,this._$AH=L,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=r,this._$Cg=null===(n=null==r?void 0:r.isConnected)||void 0===n||n}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cg}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=z(this,e,t),$(e)?e===L||null==e||""===e?(this._$AH!==L&&this._$AR(),this._$AH=L):e!==this._$AH&&e!==P&&this.$(e):void 0!==e._$litType$?this.T(e):void 0!==e.nodeType?this.S(e):x(e)?this.M(e):this.$(e)}A(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}S(e){this._$AH!==e&&(this._$AR(),this._$AH=this.A(e))}$(e){this._$AH!==L&&$(this._$AH)?this._$AA.nextSibling.data=e:this.S(w.createTextNode(e)),this._$AH=e}T(e){var t;const{values:s,_$litType$:r}=e,n="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=O.createElement(r.h,this.options)),r);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===n)this._$AH.m(s);else{const e=new T(n,this),t=e.p(this.options);e.m(s),this.S(t),this._$AH=e}}_$AC(e){let t=N.get(e.strings);return void 0===t&&N.set(e.strings,t=new O(e)),t}M(e){b(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,r=0;for(const n of e)r===t.length?t.push(s=new B(this.A(_()),this.A(_()),this,this.options)):s=t[r],s._$AI(n),r++;r<t.length&&(this._$AR(s&&s._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var s;for(null===(s=this._$AP)||void 0===s||s.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cg=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class j{constructor(e,t,s,r,n){this.type=1,this._$AH=L,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=n,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=L}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,r){const n=this.strings;let i=!1;if(void 0===n)e=z(this,e,t,0),i=!$(e)||e!==this._$AH&&e!==P,i&&(this._$AH=e);else{const r=e;let o,a;for(e=n[0],o=0;o<n.length-1;o++)a=z(this,r[s+o],t,o),a===P&&(a=this._$AH[o]),i||(i=!$(a)||a!==this._$AH[o]),a===L?e=L:e!==L&&(e+=(null!=a?a:"")+n[o+1]),this._$AH[o]=a}i&&!r&&this.k(e)}k(e){e===L?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class H extends j{constructor(){super(...arguments),this.type=3}k(e){this.element[this.name]=e===L?void 0:e}}class F extends j{constructor(){super(...arguments),this.type=4}k(e){e&&e!==L?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class W extends j{constructor(e,t,s,r,n){super(e,t,s,r,n),this.type=5}_$AI(e,t=this){var s;if((e=null!==(s=z(this,e,t,0))&&void 0!==s?s:L)===P)return;const r=this._$AH,n=e===L&&r!==L||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,i=e!==L&&(r===L||n);n&&this.element.removeEventListener(this.name,this,r),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;"function"==typeof this._$AH?this._$AH.call(null!==(s=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==s?s:this.element,e):this._$AH.handleEvent(e)}}class q{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){z(this,e)}}const V={P:"$lit$",V:v,L:g,I:1,N:U,R:T,D:x,j:z,H:B,O:j,F,B:W,W:H,Z:q};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var J,K,G;null===(u=globalThis.litHtmlPolyfillSupport)||void 0===u||u.call(globalThis,O,B),(null!==(p=globalThis.litHtmlVersions)&&void 0!==p?p:globalThis.litHtmlVersions=[]).push("2.0.0");class Q extends h{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var e,t;const s=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=s.firstChild),s}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Dt=((e,t,s)=>{var r,n;const i=null!==(r=null==s?void 0:s.renderBefore)&&void 0!==r?r:t;let o=i._$litPart$;if(void 0===o){const e=null!==(n=null==s?void 0:s.renderBefore)&&void 0!==n?n:null;i._$litPart$=o=new B(t.insertBefore(_(),e),e,void 0,null!=s?s:{})}return o._$AI(e),o})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!1)}render(){return P}}Q.finalized=!0,Q._$litElement$=!0,null===(J=globalThis.litElementHydrateSupport)||void 0===J||J.call(globalThis,{LitElement:Q}),null===(K=globalThis.litElementPolyfillSupport)||void 0===K||K.call(globalThis,{LitElement:Q}),(null!==(G=globalThis.litElementVersions)&&void 0!==G?G:globalThis.litElementVersions=[]).push("3.0.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Z=e=>t=>"function"==typeof t?((e,t)=>(window.customElements.define(e,t),t))(e,t):((e,t)=>{const{kind:s,elements:r}=t;return{kind:s,elements:r,finisher(t){window.customElements.define(e,t)}}})(e,t)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,Y=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(s){s.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(s){s.createProperty(t.key,e)}};function X(e){return(t,s)=>void 0!==s?((e,t,s)=>{t.constructor.createProperty(s,e)})(e,t,s):Y(e,t)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}function ee(e){return X({...e,state:!0})}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
function te(e,t){return(({finisher:e,descriptor:t})=>(s,r)=>{var n;if(void 0===r){const r=null!==(n=s.originalKey)&&void 0!==n?n:s.key,i=null!=t?{kind:"method",placement:"prototype",key:r,descriptor:t(s.key)}:{...s,key:r};return null!=e&&(i.finisher=function(t){e(t,r)}),i}{const n=s.constructor;void 0!==t&&Object.defineProperty(s,r,t(r)),null==e||e(n,r)}})({descriptor:s=>{const r={get(){var t,s;return null!==(s=null===(t=this.renderRoot)||void 0===t?void 0:t.querySelector(e))&&void 0!==s?s:null},enumerable:!0,configurable:!0};if(t){const t="symbol"==typeof s?Symbol():"__"+s;r.get=function(){var s,r;return void 0===this[t]&&(this[t]=null!==(r=null===(s=this.renderRoot)||void 0===s?void 0:s.querySelector(e))&&void 0!==r?r:null),this[t]}}return r}})}
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{H:se}=V,re=()=>document.createComment(""),ne=(e,t,s)=>{var r;const n=e._$AA.parentNode,i=void 0===t?e._$AB:t._$AA;if(void 0===s){const t=n.insertBefore(re(),i),r=n.insertBefore(re(),i);s=new se(t,r,e,e.options)}else{const t=s._$AB.nextSibling,o=s._$AM,a=o!==e;if(a){let t;null===(r=s._$AQ)||void 0===r||r.call(s,e),s._$AM=e,void 0!==s._$AP&&(t=e._$AU)!==o._$AU&&s._$AP(t)}if(t!==i||a){let e=s._$AA;for(;e!==t;){const t=e.nextSibling;n.insertBefore(e,i),e=t}}}return s},ie=(e,t,s=e)=>(e._$AI(t,s),e),oe={},ae=e=>{var t;null===(t=e._$AP)||void 0===t||t.call(e,!1,!0);let s=e._$AA;const r=e._$AB.nextSibling;for(;s!==r;){const e=s.nextSibling;s.remove(),s=e}},ce=1,le=2,de=e=>(...t)=>({_$litDirective$:e,values:t});
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class he{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ue=(e,t)=>{var s,r;const n=e._$AN;if(void 0===n)return!1;for(const e of n)null===(r=(s=e)._$AO)||void 0===r||r.call(s,t,!1),ue(e,t);return!0},pe=e=>{let t,s;do{if(void 0===(t=e._$AM))break;s=t._$AN,s.delete(e),e=t}while(0===(null==s?void 0:s.size))},me=e=>{for(let t;t=e._$AM;e=t){let s=t._$AN;if(void 0===s)t._$AN=s=new Set;else if(s.has(e))break;s.add(e),ge(t)}};function fe(e){void 0!==this._$AN?(pe(this),this._$AM=e,me(this)):this._$AM=e}function ve(e,t=!1,s=0){const r=this._$AH,n=this._$AN;if(void 0!==n&&0!==n.size)if(t)if(Array.isArray(r))for(let e=s;e<r.length;e++)ue(r[e],!1),pe(r[e]);else null!=r&&(ue(r,!1),pe(r));else ue(this,e)}const ge=e=>{var t,s,r,n;e.type==le&&(null!==(t=(r=e)._$AP)&&void 0!==t||(r._$AP=ve),null!==(s=(n=e)._$AQ)&&void 0!==s||(n._$AQ=fe))};class ye extends he{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,s){super._$AT(e,t,s),me(this),this.isConnected=e._$AU}_$AO(e,t=!0){var s,r;e!==this.isConnected&&(this.isConnected=e,e?null===(s=this.reconnected)||void 0===s||s.call(this):null===(r=this.disconnected)||void 0===r||r.call(this)),t&&(ue(this,e),pe(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class we{}const _e=new WeakMap,$e=de(class extends ye{render(e){return L}update(e,[t]){var s;const r=t!==this.U;return r&&void 0!==this.U&&this.nt(void 0),(r||this.rt!==this.lt)&&(this.U=t,this.ht=null===(s=e.options)||void 0===s?void 0:s.host,this.nt(this.lt=e.element)),L}nt(e){"function"==typeof this.U?(void 0!==_e.get(this.U)&&this.U.call(this.ht,void 0),_e.set(this.U,e),void 0!==e&&this.U.call(this.ht,e)):this.U.value=e}get rt(){var e;return"function"==typeof this.U?_e.get(this.U):null===(e=this.U)||void 0===e?void 0:e.value}disconnected(){this.rt===this.lt&&this.nt(void 0)}reconnected(){this.nt(this.lt)}}),be=de(class extends he{constructor(e){var t;if(super(e),e.type!==ce||"class"!==e.name||(null===(t=e.strings)||void 0===t?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(e){return" "+Object.keys(e).filter((t=>e[t])).join(" ")+" "}update(e,[t]){var s,r;if(void 0===this.st){this.st=new Set,void 0!==e.strings&&(this.et=new Set(e.strings.join(" ").split(/\s/).filter((e=>""!==e))));for(const e in t)t[e]&&!(null===(s=this.et)||void 0===s?void 0:s.has(e))&&this.st.add(e);return this.render(t)}const n=e.element.classList;this.st.forEach((e=>{e in t||(n.remove(e),this.st.delete(e))}));for(const e in t){const s=!!t[e];s===this.st.has(e)||(null===(r=this.et)||void 0===r?void 0:r.has(e))||(s?(n.add(e),this.st.add(e)):(n.remove(e),this.st.delete(e)))}return P}});
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class xe extends Error{constructor(e,t){super(t),this.title=e,Object.setPrototypeOf(this,xe.prototype)}}const Ae=(e="Page not found")=>new xe("404",e),Se=new xe("╰(⊙д⊙)╮","Open a directory to get started"),ke=new xe("╭(⊙д⊙)╯",Se.message),Ce=e=>new xe("ヽ(´ー｀)┌",e),Ee=e=>Ce(`Bad data source: ${e}`),Re=e=>new xe("（・Ａ・）",e)
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,Me=de(class extends he{constructor(e){var t;if(super(e),e.type!==ce||"style"!==e.name||(null===(t=e.strings)||void 0===t?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(e){return Object.keys(e).reduce(((t,s)=>{const r=e[s];return null==r?t:t+`${s=s.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`}),"")}update(e,[t]){const{style:s}=e.element;if(void 0===this.ut){this.ut=new Set;for(const e in t)this.ut.add(e);return this.render(t)}this.ut.forEach((e=>{null==t[e]&&(this.ut.delete(e),e.includes("-")?s.removeProperty(e):s[e]="")}));for(const e in t){const r=t[e];null!=r&&(this.ut.add(e),e.includes("-")?s.setProperty(e,r):s[e]=r)}return P}});
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class De extends he{constructor(e){if(super(e),this.it=L,e.type!==le)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===L||null==e)return this.vt=void 0,this.it=e;if(e===P)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this.vt;this.it=e;const t=[e];return t.raw=t,this.vt={_$litType$:this.constructor.resultType,strings:t,values:[]}}}De.directiveName="unsafeHTML",De.resultType=1;const Pe=de(De),Le=(e,t={"font-size":"inherit"})=>D`<span class="icon"><span class="material-icons" style="${Me(t)}">${e}</span></span>`,Ne=e=>D`<div class="content">${Pe(e)}</div>`,Ie=(e,t,s={})=>D`<a target="_blank" href="${t}" class="${be(s)}"><span class="icon-text">${e}</span>${Le("open_in_new")}</a>`,Ue={iconName:"check",cssClass:"has-text-success"},Oe={iconName:"hourglass_empty",cssClass:""},ze={iconName:"warning",cssClass:"has-text-warning"},Te={iconName:"error",cssClass:"has-text-danger"},Be=(e,t)=>D`<span class="icon-text"><span class="${e.cssClass}">${Le(e.iconName)}</span> <span>${t}</span></span>`,je=e=>{const t={"has-text-centered":!0,oops:!0,x2:"404"===e.title};return D`<div><div class="${be(t)}">${e.title}</div><div class="has-text-centered">${e.message}</div></div>`};class He extends Q{constructor(){super(),this.directoryChangedListener=e=>{this.handleDirectoryChange(e.detail)}}async subscribe(e,t){this.subscribedTo=e,void 0!==t&&await this.handleDirectoryChange(t),e.addEventListener("directory-changed",this.directoryChangedListener)}connectedCallback(){super.connectedCallback();const e={detail:async(e,t)=>{await this.subscribe(e,t)},bubbles:!0};this.dispatchEvent(new CustomEvent("subscribe",e))}disconnectedCallback(){var e;null===(e=this.subscribedTo)||void 0===e||e.removeEventListener("directory-changed",this.directoryChangedListener)}}class Fe extends He{createRenderRoot(){return this}async onBeforeEnter(e,t,s){this.router=s,this.activeUrl=e.pathname,void 0!==s.dataSource&&await this.prepareStateProtected(s.dataSource)}async handleDirectoryChange(e){await this.prepareStateProtected(e),this.requestUpdate()}async prepareStateProtected(e){try{await this.prepareState(this.location,e)}catch(e){return e instanceof xe?void(this.error=e):(this.error=new xe("(╯°□°)╯︵ ┻┻","Something really bad happened. Please report a bug."),void console.error(e))}this.error=void 0}render(){return void 0!==this.error?je(this.error):void 0===this.router.dataSource?je(Math.random()<.5?Se:ke):this.renderState()}}class We extends Fe{constructor(){super(...arguments),this.header=null}async prepareState(e,t){this.header=await t.header()}renderHeader(){if(null!==this.header)return D`<div class="notification">${this.header}</div>`}}const qe=e=>{throw console.warn(e),Ee(`"${e}"`)};class Ve{async getText(e,t,s){const r=await this.get(e,t,s);return await r.text()}async getJson(e,t,s){const r=await this.getText(e,t,s);try{return JSON.parse(r)}catch(e){qe(e)}}async getMeta(e,t){return await this.getJson(e,t,"meta.json")}async getMetas(e,t){if(void 0===t)return[];const s=[];for(const r of t)s.push(await this.getMeta(e,r));return s}}const Je=e=>e instanceof Error&&"NotFoundError"===e.name,Ke=async(e,t)=>{try{return await e}catch(e){if(Je(e))throw t();throw e}};class Ge extends Ve{constructor(e){super(),this.rootHandle=e}async header(){return null}get name(){return this.rootHandle.name}async get(e,t,s){const r=await Ke(this.rootHandle.getDirectoryHandle(e),(()=>Ee(`missing directory "${e}"`))),n=await Ke(r.getDirectoryHandle(t.toString()),(()=>Ae(`${e} not found`))),i=await Ke(n.getFileHandle(s),(()=>Ee(`missing file ${e}/${n}/${s}`)));return await i.getFile()}async getAllMeta(e){const t=[],s=await Ke(this.rootHandle.getDirectoryHandle(e),(()=>Ee(`missing directory "${e}"`)));for await(const r of s.values()){if("directory"!==r.kind)continue;const s=r.getFileHandle("meta.json");try{await s}catch(t){if(Je(t)){console.warn(`missing meta.json for ${e}/${r.name}`);continue}throw t}const n=await(await s).getFile(),i=JSON.parse(await n.text());t.push(i)}return t}}class Qe extends Ve{constructor(e){super(),this.baseURL=e}get name(){return this.baseURL}async header(){const e=await this.fetch("source.json");try{return(await e.json()).header}catch(e){qe(e)}return null}async fetch(e){const t=new URL(e,this.baseURL).toString();let s;try{s=await fetch(t)}catch(e){qe(e)}if(s=s,200!==s.status)throw new xe(s.status.toString(),`${t} ${s.statusText}`);return s}async get(e,t,s){const r=await this.fetch(`${e}/${t}/${s}`);return await r.blob()}async getAllMeta(e){const t=await this.fetch(`${e}/all.json`);try{return await t.json()}catch(e){qe(e)}}}const Ze=e=>e instanceof Ge?{ty:"FileSystemDataSource",data:e.rootHandle}:e instanceof Qe?{ty:"RemoteDataSource",data:e.baseURL}:null;let Ye=class extends He{constructor(){super(...arguments),this.directoryName="no directory",this.directoryAccess="unknown"}createRenderRoot(){return this}async handleDirectoryChange(e){if(this.directoryName=e.name,e instanceof Ge){const t=e.rootHandle;if("granted"!==await t.queryPermission({mode:"read"}))return this.directoryName="no directory",void(this.directoryAccess="unknown");"granted"===await t.queryPermission({mode:"readwrite"})?this.directoryAccess="readwrite":this.directoryAccess="readonly"}else e instanceof Qe&&(this.directoryAccess="readonly")}renderDirectoryStatus(){const e={tag:!0,"is-success":"readwrite"===this.directoryAccess,"is-info":"readonly"===this.directoryAccess,"is-warning":"unknown"===this.directoryAccess};return D`<div class="field is-grouped is-grouped-multiline"><div class="control"><div class="tags has-addons"><span class="tag is-dark">${this.directoryName}</span> <span class="${be(e)}">${this.directoryAccess}</span></div></div></div>`}render(){return D`<nav class="navbar is-light" role="navigation" aria-label="main navigation"><section class="container" style="display:flex"><div style="display:flex;justify-content:flex-start;align-items:center"><a class="navbar-item" href="/"><strong>ilmsfreeze</strong> </a><a href="/course/" class="navbar-item">Browse</a> <a href="/download" class="navbar-item">Download</a> ${Ie("GitHub","https://github.com/afq984/ilmsfreeze",{"navbar-item":!0})}</div><div class="navbar-end" style="display:flex;justify-content:flex-end;align-items:center"><div class="navbar-item">${this.renderDirectoryStatus()}</div><div class="navbar-item">${this.renderOpenButton()}</div></div></section></nav>`}renderOpenButton(){return D`<div class="buttons"><button class="button is-primary" @click="${this._dispatchClick}"><strong class="icon-text">${Le("folder")}<span>Open...</span></strong></button></div>`}_dispatchClick(){this.dispatchEvent(new CustomEvent("directory-open",{bubbles:!0,composed:!0}))}};e([ee()],Ye.prototype,"directoryName",void 0),e([ee()],Ye.prototype,"directoryAccess",void 0),Ye=e([Z("freeze-navbar")],Ye);const Xe=(e,t)=>t;let et=class extends Q{constructor(){super(),this.sortDescending=!1,this.items=[],this.fields={}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),void 0!==this.sortField&&this.sort()}sort(){if(void 0===this.sortField)return;const e=this.sortDescending?-1:1,t=this.sortField;this.items.sort(((s,r)=>((s[t]>r[t]?1:0)-(s[t]<r[t]?1:0))*e))}toggleSort(e){this.sortField===e?this.sortDescending=!this.sortDescending:(this.sortField=e,this.sortDescending=!1)}willUpdate(){void 0!==this.sortField&&this.sort()}render(){return D`<table class="table"><tr>${Object.keys(this.fields).map((e=>D`<th style="cursor:pointer;user-select:none" @click="${()=>this.toggleSort(e)}">${e} ${e===this.sortField?this.sortDescending?"⬇︎":"⬆︎":""}</th>`))}</tr>${this.items.map((e=>D`<tr>${Object.entries(this.fields).map((([t,s])=>D`<td>${s(e,e[t])}</td>`))}</tr>`))}</table>`}};e([X({attribute:!1})],et.prototype,"items",void 0),e([X({attribute:!1})],et.prototype,"fields",void 0),e([X()],et.prototype,"sortField",void 0),e([X({type:Boolean})],et.prototype,"sortDescending",void 0),et=e([Z("freeze-table")],et);const tt={text:Le("home",{"font-size":"1.25em"}),href:"/course/"},st=(e,t)=>(e[e.length-1].active=!1,e.push(t),e);let rt=class extends Q{constructor(){super(),this.fragments=[]}createRenderRoot(){return this}render(){return D`<nav class="breadcrumb" aria-label="breadcrumbs" style="margin-bottom:1.5rem"><ul>${this.fragments.map((e=>D`<li class="${e.active?"is-active":""}"><a href="${e.href}">${e.text}</a></li>`))}</ul></nav>`}};e([X({attribute:!1})],rt.prototype,"fragments",void 0),rt=e([Z("freeze-pathbar")],rt);let nt=class extends Q{createRenderRoot(){return this}render(){return D`<div><div class="oops has-text-centered">${Math.random()<.5?"╰(⊙д⊙)╮":"╭(⊙д⊙)╯"}</div><div class="has-text-centered">Open a local directory to get started</div></div>`}};nt=e([Z("freeze-no-source")],nt);let it=class extends We{constructor(){super(...arguments),this.courses=[]}renderState(){const e=(e,t)=>{const s=this.router.urlForName("freeze-course",{course_id:e.id.toString()});return D`<a href="${s}">${t}</a>`},t={id:e,serial:Xe,is_admin:Xe,name:e};return D`${this.renderHeader()}<div class="columns"><div class="column"><freeze-table sortField="id" .sortDescending="${!0}" .items="${this.courses}" .fields="${t}"></freeze-table></div></div>`}async prepareState(e,t){super.prepareState(e,t),this.courses=await t.getAllMeta("course")}};e([X({attribute:!1})],it.prototype,"courses",void 0),it=e([Z("freeze-browse")],it);
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ot=(e,t,s)=>{const r=new Map;for(let n=t;n<=s;n++)r.set(e[n],n);return r},at=de(class extends he{constructor(e){if(super(e),e.type!==le)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let r;void 0===s?s=t:void 0!==t&&(r=t);const n=[],i=[];let o=0;for(const t of e)n[o]=r?r(t,o):o,i[o]=s(t,o),o++;return{values:i,keys:n}}render(e,t,s){return this.dt(e,t,s).values}update(e,[t,s,r]){var n;const i=(e=>e._$AH)(e),{values:o,keys:a}=this.dt(t,s,r);if(!Array.isArray(i))return this.ct=a,o;const c=null!==(n=this.ct)&&void 0!==n?n:this.ct=[],l=[];let d,h,u=0,p=i.length-1,m=0,f=o.length-1;for(;u<=p&&m<=f;)if(null===i[u])u++;else if(null===i[p])p--;else if(c[u]===a[m])l[m]=ie(i[u],o[m]),u++,m++;else if(c[p]===a[f])l[f]=ie(i[p],o[f]),p--,f--;else if(c[u]===a[f])l[f]=ie(i[u],o[f]),ne(e,l[f+1],i[u]),u++,f--;else if(c[p]===a[m])l[m]=ie(i[p],o[m]),ne(e,i[u],i[p]),p--,m++;else if(void 0===d&&(d=ot(a,m,f),h=ot(c,u,p)),d.has(c[u]))if(d.has(c[p])){const t=h.get(a[m]),s=void 0!==t?i[t]:null;if(null===s){const t=ne(e,i[u]);ie(t,o[m]),l[m]=t}else l[m]=ie(s,o[m]),ne(e,i[u],s),i[t]=null;m++}else ae(i[p]),p--;else ae(i[u]),u++;for(;m<=f;){const t=ne(e,l[f+1]);ie(t,o[m]),l[m++]=t}for(;u<=p;){const e=i[u++];null!==e&&ae(e)}return this.ct=a,((e,t=oe)=>{e._$AH=t})(e,l),P}}),ct=Error,lt=(e,...t)=>{if(!e)throw new ct(`check failed: ${t}`)},dt=e=>{if(null==e)throw new ct;return e},ht=e=>{const t=parseInt(e);if(isFinite(t))return t;throw ct},ut=e=>{if(void 0===e)return{};const t={};for(const s of e){const[e,r]=s.split("-",2),n=e.toLocaleLowerCase();n in t||(t[n]=[]),t[n].push(parseInt(r))}return t},pt=(e,t)=>{const s=(t.ownerDocument||t).evaluate(e,t),r=[];let n;for(;null!==(n=s.iterateNext());)r.push(n);return r},mt=(e,t)=>{const s=pt(e,t);return lt(1===s.length,s.length),s[0]},ft=(e,t)=>({typename:e,meta:t}),vt=e=>{const[t,s]=e.split("-",2);if(!(e=>["Course","Announcement","Material","Discussion","Homework","SubmittedHomework","Attachment","Score","GroupList","Video"].includes(e))(t))throw ct(`${t} is not a Typename`);return{typename:t,id:ht(s)}},gt=async e=>{const t=await fetch(e);return lt(t.ok,t.status),t},yt=e=>(new DOMParser).parseFromString(e,"text/html"),wt=(e,t)=>{const s=new URL(e,"https://example.com").searchParams.get(t);if(null===s)throw ct;return s},_t=(e,t)=>{const s=new URL(e,"https://lms.nthu.edu.tw");return s.search=new URLSearchParams(t).toString(),s.toString()},$t=e=>{const t=pt('//div[@class="tableBox"]/table//tr[2]/td',e);return 1===t.length&&(lt(["目前尚無資料","No Data"].includes(dt(t[0].textContent))),!0)},bt=e=>{var t;(e=>{const t=pt('//div[contains(@style, "color:#F00;") and (starts-with(text(), "權限不足!") or starts-with(text(), "No Permission!"))]/text()',e);if(t.length>0)throw Re(t.join(" "))})(e);const s=pt('//div[@id="main"]',e);lt(s.length>0);const[r]=s;for(const e of['.//div[@class="infoPath"]',".//script"])for(const s of pt(e,r))null===(t=s.parentElement)||void 0===t||t.removeChild(s);return r};async function*xt(e,t,s=1){for(;;){const r=await gt(_t("/course.php",{courseID:e.id.toFixed(),f:t,page:s.toFixed()})),n=yt(await r.text());if($t(n))break;yield n;const i=pt('//span[@class="page"]//a[text()="Next"]/@href',n).map((e=>e.value));if(0===i.length)break;const o=ht(wt(i[0],"page"));s++,console.assert(s===o)}}async function*At(e){for await(const t of xt(e,"news"))for(const s of pt('//*[@id="main"]//tr[@class!="header"]',t)){const t=mt("td[1]/a/@href",s),r=mt("td[2]//a/text()",s);yield{id:ht(wt(t.value,"newsID")),title:dt(r.textContent),course:`Course-${e.id}`}}}async function*St(e){for await(const t of xt(e,"forumlist"))for(const s of pt('//*[@id="main"]//tr[@class!="header"]',t)){if(pt('.//img[@class="vmiddle"]',s).length>0)continue;const t=mt("td[1]/a/@href",s),r=mt("td[2]//a/span/text()",s);yield{id:ht(wt(t.value,"tid")),title:r.data,course:`Course-${e.id}`}}}async function*kt(e){for await(const t of xt(e,"doclist"))for(const s of pt('//*[@id="main"]//tr[@class!="header"]/td[2]/div/a',t)){const t=new URL(dt(s.getAttribute("href")),"https://example.com");"/course.php"===t.pathname&&"doc"===t.searchParams.get("f")&&(yield{id:ht(dt(t.searchParams.get("cid"))),title:dt(s.textContent),type:dt(dt(s.parentElement).getAttribute("class")),course:`Course-${e.id}`})}}async function*Ct(e){for await(const t of xt(e,"hwlist"))for(const s of pt('//*[@id="main"]//tr[@class!="header"]/td[2]/a[1]',t))yield{id:ht(wt(dt(s.getAttribute("href")),"hw")),title:dt(s.textContent),course:`Course-${e.id}`}}async function*Et(e){const t=await gt(_t("/course.php",{f:"score",courseID:e.id.toFixed()})),s=yt(await t.text());0===pt('//div[@id="main"]//input[@type="button" and @onclick="history.back()"]',s).length&&(yield{id:e.id,course:`Course-${e.id}`})}async function*Rt(e){const t=await gt(_t("/course.php",{f:"grouplist",courseID:e.id.toFixed()})),s=yt(await t.text());$t(s)||(yield{id:e.id,course:`Course-${e.id}`})}const Mt=(e,t)=>Array.from(e).map(((e,s,r)=>(e=>{const t=dt(e.codePointAt(0));return'"~*/:<>??\\|'.includes(e)||e.match(/\p{Cc}|\p{Cf}/gu)||64976<=t&&t<=65007||t<=1114111&&65534==(65534&t)})(e)||(0===s||s+1==r.length)&&(e=>e.match(/\p{Zs}|\./gu))(e)?t:e)).join("");async function*Dt(e){const t=await gt(_t("/sys/read_attach.php",{id:e.id.toFixed()})),s="meta.json"===(r=e.title)?"meta_.json":Mt(r,"_");var r;return{"meta.json":JSON.stringify({...e,children:[],saved_filename:s}),[s]:dt(t.body)}}function*Pt(e,t){const s={};for(const r of pt('.//a[starts-with(@href, "/sys/read_attach.php")]',t)){if(null===r.textContent||0==r.textContent.trim().length)continue;const t=ht(wt(dt(r.getAttribute("href")),"id"));if(s[t])continue;s[t]=!0;const n=dt(r.getAttribute("title")||r.textContent);yield{id:t,title:n,parent:e}}}async function*Lt(e){const t=await gt(_t("/course.php",{courseID:vt(e.course).id.toFixed(),f:"doc",cid:e.id.toFixed()})),s=yt(await t.text()),r=bt(s),n=`Material-${e.id}`;for(const e of Pt(n,r))yield ft("Attachment",e);if("Epowercam"===e.type){const s=await(async(e,t)=>{const s=await gt(_t("/sys/http_get_media.php",{id:e.id.toFixed(),db_table:"content",flash_installed:"false",swf_id:`swfslide${e.id}`,area_size:"724x3"})),r=dt(await s.json());if(lt("true"===r.ret.status,e.id),null===r.ret.player_width)return null;const n=yt(r.ret.embed),i=mt("//video/@src",n).value;return{id:e.id,url:new URL(i,t).toString()}})(e,t.url);null!==s&&(yield ft("Video",s))}return{"index.html":r.outerHTML}}async function*Nt(e,t){const s=await gt(_t("/course.php",{courseID:vt(t.course).id.toFixed(),f:e})),r=yt(await s.text());return{"index.html":bt(r).outerHTML}}const It=({typename:e,meta:t})=>{switch(e){case"Course":return async function*(e){const t=[["Announcement",At],["Material",kt],["Discussion",St],["Homework",Ct],["Score",Et],["GroupList",Rt]];for(const[s,r]of t)for await(const t of r(e))yield ft(s,t);const s=await gt(_t("/course.php",{courseID:e.id.toFixed(),f:"syllabus"})),r=yt(await s.text());return{"index.html":bt(r).outerHTML}}(t);case"Announcement":return async function*(e){const t=await gt(_t("/home/http_event_select.php",{id:e.id.toFixed(),type:"n"})),s=await t.json();lt("NA"!==dt(s.news.note)),lt(""!==dt(s.news.poster));const r=s.news.attach;if(null!==r)for(const t of Pt(`Announcement-${e.id}`,yt(r)))yield{typename:"Attachment",meta:t};return{"index.json":JSON.stringify(s)}}(t);case"Material":return Lt(t);case"Discussion":return async function*(e){const t=await gt(_t("/sys/lib/ajax/post.php",{id:e.id.toFixed()})),s=await t.json();for(const t of s.posts.items)for(const s of t.attach)yield ft("Attachment",{id:ht(s.id),title:s.srcName,parent:`Discussion-${e.id}`});return{"index.json":JSON.stringify(s)}}(t);case"Homework":return async function*(e){const t=`Homework-${e.id}`,s={};{const r=await gt(_t("/course.php",{courseID:vt(e.course).id.toFixed(),f:"hw",hw:e.id.toFixed()})),n=yt(await r.text()),i=bt(n);for(const e of pt('.//span[@class="toolWrapper"]',i))e.parentElement.removeChild(e);for(const e of Pt(t,i))yield ft("Attachment",e);s["index.html"]=i.outerHTML}{const t=await gt(_t("/course.php",{courseID:vt(e.course).id.toFixed(),f:"hw_doclist",hw:e.id.toFixed()})),r=yt(await t.text()),n=bt(r);if($t(n))return s;const i=mt('.//div[@class="tableBox"]//tr[@class="header"]',n),o={};i.childNodes.forEach(((e,t)=>{const s=pt("a",e);1===s.length&&(o[wt(dt(s[0].getAttribute("href")),"order")]=t)}));const a=dt(o.title),c=dt(o.name);lt(c>a,c);for(const t of pt('//div[@class="tableBox"]//tr[@class!="header"]',n)){const s=pt("div/a",t.childNodes[a]);if(0===s.length)continue;lt(1===s.length);const r=ht(wt(dt(s[0].getAttribute("href")),"cid")),n=dt(s[0].textContent).trim(),i=pt('div/img[@src="/sys/res/icon/hw_comment.png"]/@title',t.childNodes[a]);lt(i.length<2);const o=i.length>0?i[0].value:null,l=mt("div/text()|div/a/text()",t.childNodes[c]).data;yield ft("SubmittedHomework",{id:r,title:n,by:l,comment:o,course:e.course})}s["list.html"]=n.outerHTML}return s}(t);case"SubmittedHomework":return async function*(e){const t=await gt(_t("/course.php",{courseID:vt(e.course).id.toFixed(),f:"doc",cid:e.id.toFixed()})),s=yt(await t.text()),r=bt(s);for(const t of Pt(`SubmittedHomework-${e.id}`,r))yield ft("Attachment",t);return{"index.html":r.outerHTML}}(t);case"Attachment":return Dt(t);case"Video":return async function*(e){const t=await gt(e.url);return{"video.mp4":dt(t.body)}}(t);case"GroupList":return Nt("grouplist",t);case"Score":return Nt("score",t);default:throw new ct(`invalid typename: ${e}`)}},Ut=({typename:e,meta:t})=>{const s=`${e}-${t.id}`;return"name"in t?`${s}: ${t.name}`:"title"in t?`${s}: ${t.title}`:`${s}`};var Ot;!function(e){e[e.Scheduled=0]="Scheduled",e[e.Processing=1]="Processing",e[e.Completed=2]="Completed",e[e.Errored=3]="Errored"}(Ot||(Ot={}));let zt=class extends Q{constructor(){super(...arguments),this.title="title",this.body="",this.yes="OK",this.no="Cancel"}createRenderRoot(){return this}closeWith(e){this.resolve(e),this.remove()}render(){return D`<div class="modal is-active"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">${this.title}</p><button class="delete" aria-label="close" @click="${()=>this.closeWith(!1)}"></button></header><section class="modal-card-body">${this.body&&D`<p style="margin-bottom:16px">${this.body}</p>`} <button class="button is-info" @click="${()=>this.closeWith(!0)}">${this.yes}</button> ${this.no&&D`<button class="button" @click="${()=>this.closeWith(!1)}">${this.no}</button>`}</section></div></div>`}};e([ee()],zt.prototype,"title",void 0),e([ee()],zt.prototype,"body",void 0),e([ee()],zt.prototype,"yes",void 0),e([ee()],zt.prototype,"no",void 0),zt=e([Z("freeze-prompt")],zt);const Tt=(e="title",t="",s="OK",r="Cancel")=>{const n=document.createElement("freeze-prompt");return n.title=e,n.body=t,n.yes=s,n.no=r,new Promise((e=>{n.resolve=e,document.querySelector("body").appendChild(n)}))};var Bt;!function(e){e[e.None=0]="None",e[e.ReadOnly=1]="ReadOnly",e[e.ReadWrite=2]="ReadWrite",e[e.Remote=3]="Remote"}(Bt||(Bt={}));let jt=class extends Fe{constructor(){super(),this.ilmsAccess=Be(Oe,"Unknown"),this.directoryAccess=Bt.None,this.windowOnBeforeUnload=()=>this.downlaodIsRunning()||null}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.getStatus()}downlaodIsRunning(){return void 0!==this.dumper&&null!==this.dumper&&this.dumper.downloadRunning>0}async onBeforeEnter(e,t,s){window.onbeforeunload=this.windowOnBeforeUnload,await super.onBeforeEnter(e,t,s)}async onBeforeLeave(e,t){if(window.onbeforeunload=null,!this.downlaodIsRunning())return;return await Tt("Are you sure you want to leave?","Download will be interrupted.","Leave","Cancel")?void 0:t.prevent()}async getStatus(){this.ilmsAccess=await(async()=>{let e;try{e=await fetch("https://lms.nthu.edu.tw/home.php")}catch(e){return Be(Te,"Inaccessible")}const t=(new DOMParser).parseFromString(await e.text(),"text/html").querySelector("#profile");if(null===t)return Be(ze,"Logged out");const s=t.querySelector("span.lt");console.assert(null!==s);const r=s.textContent.trim();console.assert(["Name:","姓名:"].find((e=>e===r))===r,s);const n=s.nextSibling.textContent;return Be(Ue,`Logged in as ${n}`)})()}async prepareState(e,t){if(t instanceof Ge){if(this.dh=t.rootHandle,"granted"!==await this.dh.queryPermission({mode:"read"}))return void(this.directoryAccess=Bt.None);if("granted"!==await this.dh.queryPermission({mode:"readwrite"}))return void(this.directoryAccess=Bt.ReadOnly);this.directoryAccess=Bt.ReadWrite}else t instanceof Qe&&(this.directoryAccess=Bt.Remote)}renderState(){return D`<p class="has-text-centered"><span>${Ie("iLMS","https://lms.nthu.edu.tw")} status: ${this.ilmsAccess} <span style="opacity:.7">(refresh this page to update status)</span></span></p><hr><freeze-dump .directoryAccess="${this.directoryAccess}" .dh="${this.dh}"></freeze-dump>`}};e([ee()],jt.prototype,"ilmsAccess",void 0),e([ee()],jt.prototype,"directoryAccess",void 0),e([te("freeze-dump")],jt.prototype,"dumper",void 0),jt=e([Z("freeze-download")],jt);let Ht=class extends Q{constructor(){super(),this.directoryAccess=Bt.None,this.enrolledCourses=[],this.queue=[],this.added={},this.completedDownloads=0,this.downloadRunning=0,this.setEnrolledCoursesAsync()}createRenderRoot(){return this}async setEnrolledCoursesAsync(){this.enrolledCourses=await(async()=>{const e=await gt(_t("/home.php",{f:"allcourse"})),t=await e.text(),s=yt(t),r=[];for(const e of pt('.//td[@class="listTD"]/a',s)){const t=pt("b",e);let s,n=!1;t.length>0?(n=!0,[s]=t):s=e;const i=dt(s.textContent),o=dt(e.parentElement.parentElement.childNodes[1].textContent),a=dt(e.getAttribute("href")),c=a.match(new RegExp("/course/(\\d+)"));if(null===c)throw ct(`invalid course URL ${a}`);r.push({id:parseInt(c[1]),serial:o,name:i,is_admin:n,children:[]})}return r})()}async doDownload(){if(!(this.downloadRunning>0)){for(++this.downloadRunning,console.assert(1===this.downloadRunning,this.downloadRunning);this.completedDownloads<this.queue.length;this.completedDownloads++){const e=this.queue[this.completedDownloads];await e.download()}--this.downloadRunning,console.assert(0===this.downloadRunning,this.downloadRunning)}}addCourse(e){if(this.added[e.id])return;const t=new Wt(e,this.dh);this.added[e.id]=t,this.queue.push(t),this.doDownload()}addEnrolledCourses(){for(const e of this.enrolledCourses)e.id in this.added||this.addCourse(e);this.requestUpdate()}async addSelectedCourse(){const e=this.courseIdInput.value;let t;this.courseIdInput.value="";try{t=await(async e=>{const t=await gt(_t("/course.php",{f:"syllabus",courseID:e.toFixed()}));if("/course_login.php"===new URL(t.url).pathname)throw Re(`No access to course: course_id=${e}`);const s=await t.text();if(0===s.trim().length)throw Re(`Empty response returned from course, the course probably doesn't exist: course_id=${e}`);const r=yt(s),n=mt('//div[@class="infoPath"]/a/text()',r).nodeValue,i=dt(mt('//div[@class="infoTable"]//td[2]/span[@class="hint"]/text()',r).nodeValue),o=i.match(new RegExp("\\([^,()]+, ([^,()]+), [^,()]+, [^,()]+\\)"));if(!o)throw new ct(i||"hint is null");return{id:e,serial:o[1],name:n,is_admin:pt('//div[@id="main"]//a[@href="javascript:editDoc(1)"]',r).length>0}})(ht(e))}catch(e){return Tt("Cannot add course",e.toString(),"Close",""),void this.requestUpdate()}this.addCourse(t),this.requestUpdate()}_requestWriteAccess(){this.dispatchEvent(new Event("request-write",{bubbles:!0}))}render(){return this.directoryAccess===Bt.None||this.directoryAccess===Bt.Remote?D`<freeze-no-source></freeze-no-source>`:this.directoryAccess===Bt.ReadOnly?D`<div class="has-text-centered"><div class="oops">(._.)</div><div>Cannot download without write access</div><div style="margin-top:20px"><button class="button is-info" @click="${this._requestWriteAccess}">Grant Write Access</button></div></div>`:(console.assert(this.directoryAccess===Bt.ReadWrite),this.renderState())}renderForm(){return D`<div class="field is-grouped is-grouped-centered"><div class="field has-addons"><div class="control"><input id="dump-course-id" class="input has-text-centered" type="text" placeholder="Course ID" @keyup="${e=>{"Enter"===e.key&&(this.addSelectedCourse(),e.preventDefault())}}"></div><div class="control"><button class="button is-info" @click="${this.addSelectedCourse}">${Le("download")} <span>Download</span></button></div></div> <div class="field has-addons"><div class="control"><input class="input has-text-centered is-italic" type="text" value="all ${this.enrolledCourses.length} enrolled courses" readonly="readonly"></div><div class="control"><button class="button is-info" @click="${this.addEnrolledCourses}" ?disabled="${0===this.enrolledCourses.length}">${Le("download")} <span>Download</span></button></div></div></div>`}renderQueue(){return 0===this.queue.length?D`<span class="panel-block"><div style="width:100%"><div class="oops has-text-centered">ᕦ( ᐛ )ᕡ</div><div class="has-text-centered">No courses queued for download.</div></div></span>`:D`<div class="container" style="max-width:768px"><div class="panel"><p class="panel-heading">Downloads ${this.completedDownloads}/${this.queue.length}</p>${at(this.queue,(e=>e.course.id),(e=>D`<span class="panel-block"><freeze-dump-course .course="${e.course}" .downloadManager="${e}" style="width:100%"></freeze-dump-course></span>`))}</div></div>`}renderState(){return D`${this.renderForm()} ${this.renderQueue()}`}};e([ee()],Ht.prototype,"dh",void 0),e([ee()],Ht.prototype,"directoryAccess",void 0),e([ee()],Ht.prototype,"enrolledCourses",void 0),e([ee()],Ht.prototype,"queue",void 0),e([ee()],Ht.prototype,"completedDownloads",void 0),e([te("#dump-course-id")],Ht.prototype,"courseIdInput",void 0),Ht=e([Z("freeze-dump")],Ht);let Ft=class extends Q{createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.downloadManager.ui=this}startDownload(){this.downloadManager.download()}getIconName(e){switch(e){case Ot.Scheduled:return"hourglass_empty";case Ot.Processing:return"downloading";case Ot.Completed:return"file_download_done";case Ot.Errored:return"error"}}render(){const e=this.downloadManager;return D`<span>${Le(this.getIconName(e.status))} </span><span><span class="tag">${this.course.id}</span> <span>${this.course.name}</span> <span class="tag">${this.course.serial}</span> ${this.course.is_admin?D`<span class="tag is-primary is-light">admin</span>`:void 0} ${e.status===Ot.Processing?D`<progress class="progress is-info" value="${e.progress}" max="${e.total}" style="height:4px;margin-top:8px;margin-bottom:4px">${e.progress}/${e.total}</progress><small style="opacity:.7">Downloading (${e.progress}/${e.total})... ${e.message}</small>`:void 0}</span>`}};Ft=e([Z("freeze-dump-course")],Ft);class Wt extends class{constructor(e,t){this.status=Ot.Scheduled,this.progress=0,this.total=0,this.message="",this.target=e,this.dh=t}stateChanged(){}setState(e,t,s){this.progress=e,this.total=t,this.message=s,this.stateChanged()}async download(){this.status=Ot.Processing,this.stateChanged();try{await this.downloadInternal()}catch(e){return console.error("Download failed for:",this.target),console.error(e),this.status=Ot.Errored,void this.stateChanged()}this.status=Ot.Completed,this.stateChanged()}async downloadFile(e,t,s,r,n){const i=await this.dh.getDirectoryHandle(e.toLowerCase(),{create:!0}),o=await i.getDirectoryHandle(t.toFixed(),{create:!0}),a=await o.getFileHandle(r,{create:!0}),c=await a.createWritable();if(!(n instanceof ReadableStream))return await c.write(n),void await c.close();let l=0;const d=new TransformStream({transform:(e,t)=>{l+=e.byteLength,this.setState(this.progress,this.total,`${s} ${(1e-6*l).toFixed(1)}MB`),t.enqueue(e)}}),h=n.pipeThrough(d);await h.pipeTo(c)}async downloadInternal(){let e=0,t=1;const s=[this.target];for(;s.length>0;++e){const r=s.shift(),n=Ut(r);this.setState(e,t,n);const i=It(r),o=[];for(;;){const{value:a,done:c}=await i.next();if(c){const e=a;void 0===e["meta.json"]&&await this.downloadFile(r.typename,r.meta.id,n,"meta.json",JSON.stringify({...r.meta,children:o}));for(const[t,s]of Object.entries(e))await this.downloadFile(r.typename,r.meta.id,n,t,s);break}++t;const l=a;o.push(`${l.typename}-${l.meta.id}`),s.push(l),this.setState(e,t,`${n}`)}}}}{constructor(e,t){super({typename:"Course",meta:e},t),this.course=e}stateChanged(){var e;null===(e=this.ui)||void 0===e||e.requestUpdate()}}let qt=class extends Q{createRenderRoot(){return this}render(){return D`<div><div class="oops x2 has-text-centered">404</div><div class="has-text-centered">Page not found</div></div>`}};function Vt(e){return e=e||[],Array.isArray(e)?e:[e]}function Jt(e){return`[Vaadin.Router] ${e}`}qt=e([Z("freeze-404")],qt);const Kt=["module","nomodule"];function Gt(e){if(!e.match(/.+\.[m]?js$/))throw new Error(Jt(`Unsupported type for bundle "${e}": .js or .mjs expected.`))}function Qt(e){if(!e||!ss(e.path))throw new Error(Jt('Expected route config to be an object with a "path" string property, or an array of such objects'));const t=e.bundle,s=["component","redirect","bundle"];if(!(ts(e.action)||Array.isArray(e.children)||ts(e.children)||es(t)||s.some((t=>ss(e[t])))))throw new Error(Jt(`Expected route config "${e.path}" to include either "${s.join('", "')}" or "action" function but none found.`));if(t)if(ss(t))Gt(t);else{if(!Kt.some((e=>e in t)))throw new Error(Jt('Expected route bundle to include either "nomodule" or "module" keys, or both'));Kt.forEach((e=>e in t&&Gt(t[e])))}e.redirect&&["bundle","component"].forEach((t=>{t in e&&console.warn(Jt(`Route config "${e.path}" has both "redirect" and "${t}" properties, and "redirect" will always override the latter. Did you mean to only use "${t}"?`))}))}function Zt(e){Vt(e).forEach((e=>Qt(e)))}function Yt(e,t){let s=document.head.querySelector('script[src="'+e+'"][async]');return s||(s=document.createElement("script"),s.setAttribute("src",e),"module"===t?s.setAttribute("type","module"):"nomodule"===t&&s.setAttribute("nomodule",""),s.async=!0),new Promise(((e,t)=>{s.onreadystatechange=s.onload=t=>{s.__dynamicImportLoaded=!0,e(t)},s.onerror=e=>{s.parentNode&&s.parentNode.removeChild(s),t(e)},null===s.parentNode?document.head.appendChild(s):s.__dynamicImportLoaded&&e()}))}function Xt(e,t){return!window.dispatchEvent(new CustomEvent(`vaadin-router-${e}`,{cancelable:"go"===e,detail:t}))}function es(e){return"object"==typeof e&&!!e}function ts(e){return"function"==typeof e}function ss(e){return"string"==typeof e}function rs(e){const t=new Error(Jt(`Page not found (${e.pathname})`));return t.context=e,t.code=404,t}const ns=new class{};function is(e){if(e.defaultPrevented)return;if(0!==e.button)return;if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey)return;let t=e.target;const s=e.composedPath?e.composedPath():e.path||[];for(let e=0;e<s.length;e++){const r=s[e];if(r.nodeName&&"a"===r.nodeName.toLowerCase()){t=r;break}}for(;t&&"a"!==t.nodeName.toLowerCase();)t=t.parentNode;if(!t||"a"!==t.nodeName.toLowerCase())return;if(t.target&&"_self"!==t.target.toLowerCase())return;if(t.hasAttribute("download"))return;if(t.hasAttribute("router-ignore"))return;if(t.pathname===window.location.pathname&&""!==t.hash)return;const r=t.origin||function(e){const t=e.port,s=e.protocol;return`${s}//${"http:"===s&&"80"===t||"https:"===s&&"443"===t?e.hostname:e.host}`}(t);if(r!==window.location.origin)return;const{pathname:n,search:i,hash:o}=t;Xt("go",{pathname:n,search:i,hash:o})&&(e.preventDefault(),e&&"click"===e.type&&window.scrollTo(0,0))}const os={activate(){window.document.addEventListener("click",is)},inactivate(){window.document.removeEventListener("click",is)}};function as(e){if("vaadin-router-ignore"===e.state)return;const{pathname:t,search:s,hash:r}=window.location;Xt("go",{pathname:t,search:s,hash:r})}/Trident/.test(navigator.userAgent)&&!ts(window.PopStateEvent)&&(window.PopStateEvent=function(e,t){t=t||{};var s=document.createEvent("Event");return s.initEvent(e,Boolean(t.bubbles),Boolean(t.cancelable)),s.state=t.state||null,s},window.PopStateEvent.prototype=window.Event.prototype);const cs={activate(){window.addEventListener("popstate",as)},inactivate(){window.removeEventListener("popstate",as)}};var ls=$s,ds=fs,hs=function(e,t){return vs(fs(e,t))},us=vs,ps=_s,ms=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function fs(e,t){for(var s,r=[],n=0,i=0,o="",a=t&&t.delimiter||"/",c=t&&t.delimiters||"./",l=!1;null!==(s=ms.exec(e));){var d=s[0],h=s[1],u=s.index;if(o+=e.slice(i,u),i=u+d.length,h)o+=h[1],l=!0;else{var p="",m=e[i],f=s[2],v=s[3],g=s[4],y=s[5];if(!l&&o.length){var w=o.length-1;c.indexOf(o[w])>-1&&(p=o[w],o=o.slice(0,w))}o&&(r.push(o),o="",l=!1);var _=""!==p&&void 0!==m&&m!==p,$="+"===y||"*"===y,b="?"===y||"*"===y,x=p||a,A=v||g;r.push({name:f||n++,prefix:p,delimiter:x,optional:b,repeat:$,partial:_,pattern:A?ys(A):"[^"+gs(x)+"]+?"})}}return(o||i<e.length)&&r.push(o+e.substr(i)),r}function vs(e){for(var t=new Array(e.length),s=0;s<e.length;s++)"object"==typeof e[s]&&(t[s]=new RegExp("^(?:"+e[s].pattern+")$"));return function(s,r){for(var n="",i=r&&r.encode||encodeURIComponent,o=0;o<e.length;o++){var a=e[o];if("string"!=typeof a){var c,l=s?s[a.name]:void 0;if(Array.isArray(l)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===l.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var d=0;d<l.length;d++){if(c=i(l[d],a),!t[o].test(c))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');n+=(0===d?a.prefix:a.delimiter)+c}}else if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"));a.partial&&(n+=a.prefix)}else{if(c=i(String(l),a),!t[o].test(c))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+c+'"');n+=a.prefix+c}}else n+=a}return n}}function gs(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function ys(e){return e.replace(/([=!:$/()])/g,"\\$1")}function ws(e){return e&&e.sensitive?"":"i"}function _s(e,t,s){for(var r=(s=s||{}).strict,n=!1!==s.start,i=!1!==s.end,o=gs(s.delimiter||"/"),a=s.delimiters||"./",c=[].concat(s.endsWith||[]).map(gs).concat("$").join("|"),l=n?"^":"",d=0===e.length,h=0;h<e.length;h++){var u=e[h];if("string"==typeof u)l+=gs(u),d=h===e.length-1&&a.indexOf(u[u.length-1])>-1;else{var p=u.repeat?"(?:"+u.pattern+")(?:"+gs(u.delimiter)+"(?:"+u.pattern+"))*":u.pattern;t&&t.push(u),u.optional?u.partial?l+=gs(u.prefix)+"("+p+")?":l+="(?:"+gs(u.prefix)+"("+p+"))?":l+=gs(u.prefix)+"("+p+")"}}return i?(r||(l+="(?:"+o+")?"),l+="$"===c?"$":"(?="+c+")"):(r||(l+="(?:"+o+"(?="+c+"))?"),d||(l+="(?="+o+"|"+c+")")),new RegExp(l,ws(s))}function $s(e,t,s){return e instanceof RegExp?function(e,t){if(!t)return e;var s=e.source.match(/\((?!\?)/g);if(s)for(var r=0;r<s.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}(e,t):Array.isArray(e)?function(e,t,s){for(var r=[],n=0;n<e.length;n++)r.push($s(e[n],t,s).source);return new RegExp("(?:"+r.join("|")+")",ws(s))}(e,t,s):function(e,t,s){return _s(fs(e,s),t,s)}(e,t,s)}ls.parse=ds,ls.compile=hs,ls.tokensToFunction=us,ls.tokensToRegExp=ps;const{hasOwnProperty:bs}=Object.prototype,xs=new Map;function As(e){try{return decodeURIComponent(e)}catch(t){return e}}function Ss(e,t,s,r,n){let i,o,a=0,c=e.path||"";return"/"===c.charAt(0)&&(s&&(c=c.substr(1)),s=!0),{next(l){if(e===l)return{done:!0};const d=e.__children=e.__children||e.children;if(!i&&(i=function(e,t,s,r,n){const i=`${e}|${s=!!s}`;let o=xs.get(i);if(!o){const t=[];o={keys:t,pattern:ls(e,t,{end:s,strict:""===e})},xs.set(i,o)}const a=o.pattern.exec(t);if(!a)return null;const c=Object.assign({},n);for(let e=1;e<a.length;e++){const t=o.keys[e-1],s=t.name,r=a[e];void 0===r&&bs.call(c,s)||(t.repeat?c[s]=r?r.split(t.delimiter).map(As):[]:c[s]=r?As(r):r)}return{path:a[0],keys:(r||[]).concat(o.keys),params:c}}(c,t,!d,r,n),i))return{done:!1,value:{route:e,keys:i.keys,params:i.params,path:i.path}};if(i&&d)for(;a<d.length;){if(!o){const r=d[a];r.parent=e;let n=i.path.length;n>0&&"/"===t.charAt(n)&&(n+=1),o=Ss(r,t.substr(n),s,i.keys,i.params)}const r=o.next(l);if(!r.done)return{done:!1,value:r.value};o=null,a++}return{done:!0}}}}function ks(e){if(ts(e.route.action))return e.route.action(e)}xs.set("|false",{keys:[],pattern:/(?:)/});class Cs{constructor(e,t={}){if(Object(e)!==e)throw new TypeError("Invalid routes");this.baseUrl=t.baseUrl||"",this.errorHandler=t.errorHandler,this.resolveRoute=t.resolveRoute||ks,this.context=Object.assign({resolver:this},t.context),this.root=Array.isArray(e)?{path:"",__children:e,parent:null,__synthetic:!0}:e,this.root.parent=null}getRoutes(){return[...this.root.__children]}setRoutes(e){Zt(e);const t=[...Vt(e)];this.root.__children=t}addRoutes(e){return Zt(e),this.root.__children.push(...Vt(e)),this.getRoutes()}removeRoutes(){this.setRoutes([])}resolve(e){const t=Object.assign({},this.context,ss(e)?{pathname:e}:e),s=Ss(this.root,this.__normalizePathname(t.pathname),this.baseUrl),r=this.resolveRoute;let n=null,i=null,o=t;function a(e,c=n.value.route,l){const d=null===l&&n.value.route;return n=i||s.next(d),i=null,e||!n.done&&function(e,t){let s=t;for(;s;)if(s=s.parent,s===e)return!0;return!1}(c,n.value.route)?n.done?Promise.reject(rs(t)):(o=Object.assign(o?{chain:o.chain?o.chain.slice(0):[]}:{},t,n.value),function(e,t){const{route:s,path:r}=t;if(s&&!s.__synthetic){const t={path:r,route:s};if(e.chain){if(s.parent){let t=e.chain.length;for(;t--&&e.chain[t].route&&e.chain[t].route!==s.parent;)e.chain.pop()}}else e.chain=[];e.chain.push(t)}}(o,n.value),Promise.resolve(r(o)).then((t=>null!=t&&t!==ns?(o.result=t.result||t,o):a(e,c,t)))):(i=n,Promise.resolve(ns))}return t.next=a,Promise.resolve().then((()=>a(!0,this.root))).catch((e=>{const t=function(e){let t=`Path '${e.pathname}' is not properly resolved due to an error.`;const s=(e.route||{}).path;return s&&(t+=` Resolution had failed on route: '${s}'`),t}(o);if(e?console.warn(t):e=new Error(t),e.context=e.context||o,e instanceof DOMException||(e.code=e.code||500),this.errorHandler)return o.result=this.errorHandler(e),o;throw e}))}static __createUrl(e,t){return new URL(e,t)}get __effectiveBaseUrl(){return this.baseUrl?this.constructor.__createUrl(this.baseUrl,document.baseURI||document.URL).href.replace(/[^\/]*$/,""):""}__normalizePathname(e){if(!this.baseUrl)return e;const t=this.__effectiveBaseUrl,s=this.constructor.__createUrl(e,t).href;return s.slice(0,t.length)===t?s.slice(t.length):void 0}}Cs.pathToRegexp=ls;const{pathToRegexp:Es}=Cs,Rs=new Map;function Ms(e,t,s){const r=t.name||t.component;if(r&&(e.has(r)?e.get(r).push(t):e.set(r,[t])),Array.isArray(s))for(let r=0;r<s.length;r++){const n=s[r];n.parent=t,Ms(e,n,n.__children||n.children)}}function Ds(e,t){const s=e.get(t);if(s&&s.length>1)throw new Error(`Duplicate route with name "${t}". Try seting unique 'name' route properties.`);return s&&s[0]}function Ps(e){let t=e.path;return t=Array.isArray(t)?t[0]:t,void 0!==t?t:""}function Ls(e,t={}){if(!(e instanceof Cs))throw new TypeError("An instance of Resolver is expected");const s=new Map;return(r,n)=>{let i=Ds(s,r);if(!i&&(s.clear(),Ms(s,e.root,e.root.__children),i=Ds(s,r),!i))throw new Error(`Route "${r}" not found`);let o=Rs.get(i.fullPath);if(!o){let e=Ps(i),t=i.parent;for(;t;){const s=Ps(t);s&&(e=s.replace(/\/$/,"")+"/"+e.replace(/^\//,"")),t=t.parent}const s=Es.parse(e),r=Es.tokensToFunction(s),n=Object.create(null);for(let e=0;e<s.length;e++)ss(s[e])||(n[s[e].name]=!0);o={toPath:r,keys:n},Rs.set(e,o),i.fullPath=e}let a=o.toPath(n,t)||"/";if(t.stringifyQueryParams&&n){const e={},s=Object.keys(n);for(let t=0;t<s.length;t++){const r=s[t];o.keys[r]||(e[r]=n[r])}const r=t.stringifyQueryParams(e);r&&(a+="?"===r.charAt(0)?r:`?${r}`)}return a}}let Ns=[];function Is(e){Ns.forEach((e=>e.inactivate())),e.forEach((e=>e.activate())),Ns=e}function Us(e,t){return e.classList.add(t),new Promise((s=>{if((e=>{const t=getComputedStyle(e).getPropertyValue("animation-name");return t&&"none"!==t})(e)){const r=e.getBoundingClientRect(),n=`height: ${r.bottom-r.top}px; width: ${r.right-r.left}px`;e.setAttribute("style",`position: absolute; ${n}`),((e,t)=>{const s=()=>{e.removeEventListener("animationend",s),t()};e.addEventListener("animationend",s)})(e,(()=>{e.classList.remove(t),e.removeAttribute("style"),s()}))}else e.classList.remove(t),s()}))}function Os(e){return null!=e}function zs({pathname:e="",search:t="",hash:s="",chain:r=[],params:n={},redirectFrom:i,resolver:o},a){const c=r.map((e=>e.route));return{baseUrl:o&&o.baseUrl||"",pathname:e,search:t,hash:s,routes:c,route:a||c.length&&c[c.length-1]||null,params:n,redirectFrom:i,getUrl:(e={})=>Fs(qs.pathToRegexp.compile(Ws(c))(Object.assign({},n,e)),o)}}function Ts(e,t){const s=Object.assign({},e.params);return{redirect:{pathname:t,from:e.pathname,params:s}}}function Bs(e,t,s){if(ts(e))return e.apply(s,t)}function js(e,t,s){return r=>r&&(r.cancel||r.redirect)?r:s?Bs(s[e],t,s):void 0}function Hs(e){if(e&&e.length){const t=e[0].parentNode;for(let s=0;s<e.length;s++)t.removeChild(e[s])}}function Fs(e,t){const s=t.__effectiveBaseUrl;return s?t.constructor.__createUrl(e.replace(/^\//,""),s).pathname:e}function Ws(e){return e.map((e=>e.path)).reduce(((e,t)=>t.length?e.replace(/\/$/,"")+"/"+t.replace(/^\//,""):e),"")}class qs extends Cs{constructor(e,t){const s=document.head.querySelector("base"),r=s&&s.getAttribute("href");super([],Object.assign({baseUrl:r&&Cs.__createUrl(r,document.URL).pathname.replace(/[^\/]*$/,"")},t)),this.resolveRoute=e=>this.__resolveRoute(e);const n=qs.NavigationTrigger;qs.setTriggers.apply(qs,Object.keys(n).map((e=>n[e]))),this.baseUrl,this.ready,this.ready=Promise.resolve(e),this.location,this.location=zs({resolver:this}),this.__lastStartedRenderId=0,this.__navigationEventHandler=this.__onNavigationEvent.bind(this),this.setOutlet(e),this.subscribe(),this.__createdByRouter=new WeakMap,this.__addedByRouter=new WeakMap}__resolveRoute(e){const t=e.route;let s=Promise.resolve();ts(t.children)&&(s=s.then((()=>t.children(function(e){const t=Object.assign({},e);return delete t.next,t}(e)))).then((e=>{Os(e)||ts(t.children)||(e=t.children),function(e,t){if(!Array.isArray(e)&&!es(e))throw new Error(Jt(`Incorrect "children" value for the route ${t.path}: expected array or object, but got ${e}`));t.__children=[];const s=Vt(e);for(let e=0;e<s.length;e++)Qt(s[e]),t.__children.push(s[e])}(e,t)})));const r={redirect:t=>Ts(e,t),component:e=>{const t=document.createElement(e);return this.__createdByRouter.set(t,!0),t}};return s.then((()=>{if(this.__isLatestRender(e))return Bs(t.action,[e,r],t)})).then((e=>{return Os(e)&&(e instanceof HTMLElement||e.redirect||e===ns)?e:ss(t.redirect)?r.redirect(t.redirect):t.bundle?(s=t.bundle,ss(s)?Yt(s):Promise.race(Kt.filter((e=>e in s)).map((e=>Yt(s[e],e))))).then((()=>{}),(()=>{throw new Error(Jt(`Bundle not found: ${t.bundle}. Check if the file name is correct`))})):void 0;var s})).then((e=>Os(e)?e:ss(t.component)?r.component(t.component):void 0))}setOutlet(e){e&&this.__ensureOutlet(e),this.__outlet=e}getOutlet(){return this.__outlet}setRoutes(e,t=!1){return this.__previousContext=void 0,this.__urlForName=void 0,super.setRoutes(e),t||this.__onNavigationEvent(),this.ready}render(e,t){const s=++this.__lastStartedRenderId,r=Object.assign({search:"",hash:""},ss(e)?{pathname:e}:e,{__renderId:s});return this.ready=this.resolve(r).then((e=>this.__fullyResolveChain(e))).then((e=>{if(this.__isLatestRender(e)){const r=this.__previousContext;if(e===r)return this.__updateBrowserHistory(r,!0),this.location;if(this.location=zs(e),t&&this.__updateBrowserHistory(e,1===s),Xt("location-changed",{router:this,location:this.location}),e.__skipAttach)return this.__copyUnchangedElements(e,r),this.__previousContext=e,this.location;this.__addAppearingContent(e,r);const n=this.__animateIfNeeded(e);return this.__runOnAfterEnterCallbacks(e),this.__runOnAfterLeaveCallbacks(e,r),n.then((()=>{if(this.__isLatestRender(e))return this.__removeDisappearingContent(),this.__previousContext=e,this.location}))}})).catch((e=>{if(s===this.__lastStartedRenderId)throw t&&this.__updateBrowserHistory(r),Hs(this.__outlet&&this.__outlet.children),this.location=zs(Object.assign(r,{resolver:this})),Xt("error",Object.assign({router:this,error:e},r)),e})),this.ready}__fullyResolveChain(e,t=e){return this.__findComponentContextAfterAllRedirects(t).then((s=>{const r=s!==t?s:e,n=Fs(Ws(s.chain),s.resolver)===s.pathname,i=(e,t=e.route,s)=>e.next(void 0,t,s).then((s=>null===s||s===ns?n?e:null!==t.parent?i(e,t.parent,s):s:s));return i(s).then((e=>{if(null===e||e===ns)throw rs(r);return e&&e!==ns&&e!==s?this.__fullyResolveChain(r,e):this.__amendWithOnBeforeCallbacks(s)}))}))}__findComponentContextAfterAllRedirects(e){const t=e.result;return t instanceof HTMLElement?(function(e,t){t.location=zs(e);const s=e.chain.map((e=>e.route)).indexOf(e.route);e.chain[s].element=t}(e,t),Promise.resolve(e)):t.redirect?this.__redirect(t.redirect,e.__redirectCount,e.__renderId).then((e=>this.__findComponentContextAfterAllRedirects(e))):t instanceof Error?Promise.reject(t):Promise.reject(new Error(Jt(`Invalid route resolution result for path "${e.pathname}". Expected redirect object or HTML element, but got: "${function(e){if("object"!=typeof e)return String(e);const t=Object.prototype.toString.call(e).match(/ (.*)\]$/)[1];return"Object"===t||"Array"===t?`${t} ${JSON.stringify(e)}`:t}(t)}". Double check the action return value for the route.`)))}__amendWithOnBeforeCallbacks(e){return this.__runOnBeforeCallbacks(e).then((t=>t===this.__previousContext||t===e?t:this.__fullyResolveChain(t)))}__runOnBeforeCallbacks(e){const t=this.__previousContext||{},s=t.chain||[],r=e.chain;let n=Promise.resolve();const i=()=>({cancel:!0}),o=t=>Ts(e,t);if(e.__divergedChainIndex=0,e.__skipAttach=!1,s.length){for(let t=0;t<Math.min(s.length,r.length)&&(s[t].route===r[t].route&&(s[t].path===r[t].path||s[t].element===r[t].element)&&this.__isReusableElement(s[t].element,r[t].element));t=++e.__divergedChainIndex);if(e.__skipAttach=r.length===s.length&&e.__divergedChainIndex==r.length&&this.__isReusableElement(e.result,t.result),e.__skipAttach){for(let t=r.length-1;t>=0;t--)n=this.__runOnBeforeLeaveCallbacks(n,e,{prevent:i},s[t]);for(let t=0;t<r.length;t++)n=this.__runOnBeforeEnterCallbacks(n,e,{prevent:i,redirect:o},r[t]),s[t].element.location=zs(e,s[t].route)}else for(let t=s.length-1;t>=e.__divergedChainIndex;t--)n=this.__runOnBeforeLeaveCallbacks(n,e,{prevent:i},s[t])}if(!e.__skipAttach)for(let t=0;t<r.length;t++)t<e.__divergedChainIndex?t<s.length&&s[t].element&&(s[t].element.location=zs(e,s[t].route)):(n=this.__runOnBeforeEnterCallbacks(n,e,{prevent:i,redirect:o},r[t]),r[t].element&&(r[t].element.location=zs(e,r[t].route)));return n.then((t=>{if(t){if(t.cancel)return this.__previousContext.__renderId=e.__renderId,this.__previousContext;if(t.redirect)return this.__redirect(t.redirect,e.__redirectCount,e.__renderId)}return e}))}__runOnBeforeLeaveCallbacks(e,t,s,r){const n=zs(t);return e.then((e=>{if(this.__isLatestRender(t)){return js("onBeforeLeave",[n,s,this],r.element)(e)}})).then((e=>{if(!(e||{}).redirect)return e}))}__runOnBeforeEnterCallbacks(e,t,s,r){const n=zs(t,r.route);return e.then((e=>{if(this.__isLatestRender(t)){return js("onBeforeEnter",[n,s,this],r.element)(e)}}))}__isReusableElement(e,t){return!(!e||!t)&&(this.__createdByRouter.get(e)&&this.__createdByRouter.get(t)?e.localName===t.localName:e===t)}__isLatestRender(e){return e.__renderId===this.__lastStartedRenderId}__redirect(e,t,s){if(t>256)throw new Error(Jt(`Too many redirects when rendering ${e.from}`));return this.resolve({pathname:this.urlForPath(e.pathname,e.params),redirectFrom:e.from,__redirectCount:(t||0)+1,__renderId:s})}__ensureOutlet(e=this.__outlet){if(!(e instanceof Node))throw new TypeError(Jt(`Expected router outlet to be a valid DOM Node (but got ${e})`))}__updateBrowserHistory({pathname:e,search:t="",hash:s=""},r){if(window.location.pathname!==e||window.location.search!==t||window.location.hash!==s){const n=r?"replaceState":"pushState";window.history[n](null,document.title,e+t+s),window.dispatchEvent(new PopStateEvent("popstate",{state:"vaadin-router-ignore"}))}}__copyUnchangedElements(e,t){let s=this.__outlet;for(let r=0;r<e.__divergedChainIndex;r++){const n=t&&t.chain[r].element;if(n){if(n.parentNode!==s)break;e.chain[r].element=n,s=n}}return s}__addAppearingContent(e,t){this.__ensureOutlet(),this.__removeAppearingContent();const s=this.__copyUnchangedElements(e,t);this.__appearingContent=[],this.__disappearingContent=Array.from(s.children).filter((t=>this.__addedByRouter.get(t)&&t!==e.result));let r=s;for(let t=e.__divergedChainIndex;t<e.chain.length;t++){const n=e.chain[t].element;n&&(r.appendChild(n),this.__addedByRouter.set(n,!0),r===s&&this.__appearingContent.push(n),r=n)}}__removeDisappearingContent(){this.__disappearingContent&&Hs(this.__disappearingContent),this.__disappearingContent=null,this.__appearingContent=null}__removeAppearingContent(){this.__disappearingContent&&this.__appearingContent&&(Hs(this.__appearingContent),this.__disappearingContent=null,this.__appearingContent=null)}__runOnAfterLeaveCallbacks(e,t){if(t)for(let s=t.chain.length-1;s>=e.__divergedChainIndex&&this.__isLatestRender(e);s--){const r=t.chain[s].element;if(r)try{const s=zs(e);Bs(r.onAfterLeave,[s,{},t.resolver],r)}finally{this.__disappearingContent.indexOf(r)>-1&&Hs(r.children)}}}__runOnAfterEnterCallbacks(e){for(let t=e.__divergedChainIndex;t<e.chain.length&&this.__isLatestRender(e);t++){const s=e.chain[t].element||{},r=zs(e,e.chain[t].route);Bs(s.onAfterEnter,[r,{},e.resolver],s)}}__animateIfNeeded(e){const t=(this.__disappearingContent||[])[0],s=(this.__appearingContent||[])[0],r=[],n=e.chain;let i;for(let e=n.length;e>0;e--)if(n[e-1].route.animate){i=n[e-1].route.animate;break}if(t&&s&&i){const e=es(i)&&i.leave||"leaving",n=es(i)&&i.enter||"entering";r.push(Us(t,e)),r.push(Us(s,n))}return Promise.all(r).then((()=>e))}subscribe(){window.addEventListener("vaadin-router-go",this.__navigationEventHandler)}unsubscribe(){window.removeEventListener("vaadin-router-go",this.__navigationEventHandler)}__onNavigationEvent(e){const{pathname:t,search:s,hash:r}=e?e.detail:window.location;ss(this.__normalizePathname(t))&&(e&&e.preventDefault&&e.preventDefault(),this.render({pathname:t,search:s,hash:r},!0))}static setTriggers(...e){Is(e)}urlForName(e,t){return this.__urlForName||(this.__urlForName=Ls(this)),Fs(this.__urlForName(e,t),this)}urlForPath(e,t){return Fs(qs.pathToRegexp.compile(e)(t),this)}static go(e){const{pathname:t,search:s,hash:r}=ss(e)?this.__createUrl(e,"http://a"):e;return Xt("go",{pathname:t,search:s,hash:r})}}const Vs=/\/\*\*\s+vaadin-dev-mode:start([\s\S]*)vaadin-dev-mode:end\s+\*\*\//i,Js=window.Vaadin&&window.Vaadin.Flow&&window.Vaadin.Flow.clients;function Ks(e,t){if("function"!=typeof e)return;const s=Vs.exec(e.toString());if(s)try{e=new Function(s[1])}catch(e){console.log("vaadin-development-mode-detector: uncommentAndRun() failed",e)}return e(t)}window.Vaadin=window.Vaadin||{};const Gs=function(e,t){if(window.Vaadin.developmentMode)return Ks(e,t)};function Qs(){}void 0===window.Vaadin.developmentMode&&(window.Vaadin.developmentMode=function(){try{return!!localStorage.getItem("vaadin.developmentmode.force")||["localhost","127.0.0.1"].indexOf(window.location.hostname)>=0&&(Js?!(Js&&Object.keys(Js).map((e=>Js[e])).filter((e=>e.productionMode)).length>0):!Ks((function(){return!0})))}catch(e){return!1}}());window.Vaadin=window.Vaadin||{},window.Vaadin.registrations=window.Vaadin.registrations||[],window.Vaadin.registrations.push({is:"@vaadin/router",version:"1.7.4"}),Gs(Qs),qs.NavigationTrigger={POPSTATE:cs,CLICK:os};const Zs={typename:"announcement",displayname:"公告",countable:!0,path:"/course/:course_id/announcement/",component:"freeze-course-announcements"},Ys={typename:"material",displayname:"上課教材",countable:!0,path:"/course/:course_id/material/",component:"freeze-course-materials"},Xs={typename:"discussion",displayname:"討論區",countable:!0,path:"/course/:course_id/discussion/",component:"freeze-course-discussions"},er={typename:"homework",displayname:"作業",countable:!0,path:"/course/:course_id/homework/",component:"freeze-course-homeworks"},tr={typename:"score",displayname:"成績計算",countable:!1,path:"/course/:course_id/score",component:"freeze-course-score"},sr={typename:"grouplist",displayname:"小組專區",countable:!1,path:"/course/:course_id/grouplist",component:"freeze-course-grouplist"},rr=[{displayname:"課程說明",countable:!1,path:"/course/:course_id",component:"freeze-course"},Zs,Ys,Xs,er,tr,sr],nr=(e,t)=>(window.open(e.pathname+e.search),t.prevent()),ir=[{path:"/",component:"freeze-index"},{path:"/course/",component:"freeze-browse"},{path:"/download",component:"freeze-download"},{path:"/course/:course_id/announcement/:announcement_id",component:"freeze-announcement"},{path:"/course/:course_id/material/:material_id",component:"freeze-material"},{path:"/course/:course_id/discussion/:discussion_id",component:"freeze-discussion"},{path:"/course/:course_id/homework/:homework_id",component:"freeze-homework"},{path:"/course/:course_id/homework/:homework_id/submission/",component:"freeze-homework-submissions"},{path:"/course/:course_id/homework/:homework_id/submission/:submittedhomework_id",component:"freeze-submission"},{path:"/attachment/(.*)",action:nr},{path:"/sys/read_attach.php",action:nr}].concat(rr,[{path:"/course.php",action:async(e,t)=>{const s=new URLSearchParams(e.search);let r;try{r=(e=>{const t=t=>{const s=e.get(t);if(null===s)throw Ce(`missing required query parameter: ${t}`);return s},s=t("courseID");switch(e.get("f")||"syllabus"){case"syllabus":return`/course/${s}`;case"activity":case"news":return`/course/${s}/announcement/`;case"doclist":return`/course/${s}/material/`;case"forumlist":return`/course/${s}/discussion/`;case"hwlist":return`/course/${s}/homework/`;case"score":case"score_edit":return`/course/${s}/score`;case"group":case"grouplist":case"teamall":case"team_forumlist":case"team_memberlist":case"team_homework":return`/course/${s}/grouplist`;case"news_show":return`/course/${s}/announcement/${t("newsID")}`;default:throw Ae();case"forum":return`/course/${s}/discussion/${t("tid")}`;case"hw":return`/course/${s}/homework/${t("hw")}`;case"hw_doclist":return`/course/${s}/homework/${t("hw")}/submission/`}})(s)}catch(e){if(e instanceof xe)return t.component("freeze-404");throw e}return t.redirect(r)}},{path:"(.*)",component:"freeze-404"}]);class or extends qs{}let ar=class extends Q{createRenderRoot(){return this}renderLink(e,t){const s=this.courseChildren,r=((e,t,s)=>{const r={course_id:t.toString()};return e.urlForName(s.component,r)})(this.router,e.id,t),n={"is-active":r===this.activeUrl,"side-menu-disabled":void 0!==t.typename&&!(t.typename in s)};let i=t.displayname;return void 0!==t.typename&&t.countable&&(i=`${i} (${(s[t.typename]||[]).length})`),D`<a href="${r}" class="${be(n)}">${i}</a>`}render(){const e=this.courseMeta;return D`<aside class="menu"><p class="menu-label">${e.serial}</p><ul class="menu-list">${rr.map((t=>D`<li>${this.renderLink(e,t)}</li>`))}</ul></aside>`}};e([X({attribute:!1})],ar.prototype,"courseMeta",void 0),e([X({attribute:!1})],ar.prototype,"courseChildren",void 0),e([X({attribute:!1})],ar.prototype,"activeUrl",void 0),e([X({attribute:!1})],ar.prototype,"router",void 0),ar=e([Z("freeze-sidemenu")],ar);const cr=e=>{const t=e.split("/");return t[t.length-1]},lr=(e,t,s,r=cr)=>{const n=(new DOMParser).parseFromString(e,"text/html");for(const e of n.querySelectorAll(t)){const t=e.getAttribute("src");if(null!==t&&t.startsWith("/sysdata/")){const n=r(t);n in s&&e.setAttribute("src",s[n])}}return n.querySelector("body").innerHTML},dr=async(e,t,s)=>{const r=((e,t)=>{const s=e[t].toString();return parseInt(s)})(e,`${s}_id`);return await t.getMeta(s,r)};class hr extends We{constructor(){super()}async prepareState(e,t){super.prepareState(e,t);const s=parseInt(e.params.course_id.toString());this.courseMeta=await t.getMeta("course",s),this.courseChildren=ut(this.courseMeta.children)}renderState(){return D`${this.renderHeader()}<freeze-pathbar .fragments="${this.fragments()}"></freeze-pathbar><div class="columns"><freeze-sidemenu class="column is-one-fifth" .courseMeta="${this.courseMeta}" .courseChildren="${this.courseChildren}" .activeUrl="${this.activeUrl}" .router="${this.router}"></freeze-sidemenu><div class="column">${this.renderBody()}</div></div>`}}let ur=class extends hr{constructor(){super(...arguments),this.body=""}fragments(){return[tt,{text:this.courseMeta.name,href:`/course/${this.courseMeta.id}/`,active:!0}]}async prepareState(e,t){await super.prepareState(e,t),this.body=await t.getText("course",this.courseMeta.id,"index.html")}renderBody(){return Ne(this.body)}};ur=e([Z("freeze-course")],ur);class pr extends hr{get typename(){return this.menuItem.typename}fragments(){const e={course_id:this.courseMeta.id.toString()};return[tt,{text:this.courseMeta.name,href:this.router.urlForName("freeze-course",e)},{text:this.menuItem.displayname,href:this.router.urlForName(this.menuItem.component,e),active:!0}]}}let mr=class extends pr{constructor(){super(...arguments),this.menuItem=tr,this.body=""}async prepareState(e,t){await super.prepareState(e,t),this.body=await t.getText("score",this.courseMeta.id,"index.html")}renderBody(){return Ne(this.body)}};mr=e([Z("freeze-course-score")],mr);let fr=class extends pr{constructor(){super(...arguments),this.menuItem=sr,this.body=""}async prepareState(e,t){await super.prepareState(e,t),this.body=await t.getText("grouplist",this.courseMeta.id,"index.html")}renderBody(){return Ne(this.body)}};fr=e([Z("freeze-course-grouplist")],fr);class vr extends pr{constructor(){super(...arguments),this.table=[]}makeLinkFn(e){const t=`${this.typename}_id`;return(s,r)=>{const n=this.router.urlForName(e,{course_id:this.courseMeta.id.toString(),[t]:s.id.toString()});return D`<a href="${n}">${r}</a>`}}async prepareState(e,t){await super.prepareState(e,t),this.table=await t.getMetas(this.typename,this.courseChildren[this.typename])}renderBody(){return D`<freeze-table .items="${this.table}" .fields="${this.fields()}" .sortDescending="${!0}" .sortField="${"id"}"></freeze-table>`}}let gr=class extends vr{constructor(){super(...arguments),this.menuItem=Zs}fields(){return{id:this.makeLinkFn("freeze-announcement"),title:this.makeLinkFn("freeze-announcement")}}};gr=e([Z("freeze-course-announcements")],gr);let yr=class extends vr{constructor(){super(...arguments),this.menuItem=Ys}fields(){return{id:this.makeLinkFn("freeze-material"),title:this.makeLinkFn("freeze-material"),type:Xe}}};yr=e([Z("freeze-course-materials")],yr);let wr=class extends vr{constructor(){super(...arguments),this.menuItem=Xs}fields(){return{id:this.makeLinkFn("freeze-discussion"),title:this.makeLinkFn("freeze-discussion")}}};wr=e([Z("freeze-course-discussions")],wr);let _r=class extends vr{constructor(){super(...arguments),this.menuItem=er}fields(){return{id:this.makeLinkFn("freeze-homework"),title:this.makeLinkFn("freeze-homework")}}};_r=e([Z("freeze-course-homeworks")],_r);let $r=class extends pr{constructor(){super(...arguments),this.menuItem=Zs}fragments(){const e=this.announcementMeta;return st(super.fragments(),{text:e.title,href:this.router.urlForName("freeze-announcement",{course_id:this.courseMeta.id.toString(),announcement_id:e.id.toString()}),active:!0})}async prepareState(e,t){await super.prepareState(e,t);const s=parseInt(e.params.announcement_id.toString());this.announcementMeta=await t.getMeta("announcement",s),this.news=(await t.getJson("announcement",this.announcementMeta.id,"index.json")).news;const r=ut(this.announcementMeta.children);this.attachments=await t.getMetas("attachment",r.attachment)}renderAttachments(){if(void 0!==this.attachments)return D`<br>${this.attachments.map((e=>D`${Le("attachment")} <a href="/attachment/${e.id}" target="_blank">${e.title}</a>`))}`}renderBody(){return D`<h1 class="title">${this.announcementMeta.title}</h1><strong>${this.news.poster}</strong> <small>${Le("visibility")} <span>${this.news.views}</span> </small><small>${Le("calendar_today")} <span>${this.news.createTime}</span></small><div class="content"><br>${Pe(this.news.note)} ${this.renderAttachments()}</div>`}};$r=e([Z("freeze-announcement")],$r);let br=class extends pr{constructor(){super(...arguments),this.menuItem=Ys}fragments(){const e=this.materialMeta;return st(super.fragments(),{text:e.title,href:this.router.urlForName("freeze-material",{course_id:this.courseMeta.id.toString(),material_id:e.id.toString()}),active:!0})}async prepareState(e,t){super.prepareState(e,t),this.materialMeta=await dr(e.params,t,"material"),this.materialChildren=ut(this.materialMeta.children);const s=await t.getText("material",this.materialMeta.id,"index.html"),r={};for(const e of this.materialChildren.attachment||[])r[`${e}.mp4`]=`/attachment/${e}`;this.materialBody=lr(s,"video",r)}renderVideo(){const e=this.materialChildren.video;if(void 0!==e)return D`<video src="/video/${e[0]}" controls></video>`}renderBody(){return D`${this.renderVideo()}<div class="contenet">${Pe(this.materialBody)}</div>`}};br=e([Z("freeze-material")],br);let xr=class extends pr{constructor(){super(...arguments),this.menuItem=Xs}async prepareState(e,t){super.prepareState(e,t),this.discussionMeta=await dr(e.params,t,"discussion"),this.discussionJson=await t.getJson("discussion",this.discussionMeta.id,"index.json");for(const e of this.discussionJson.posts.items){if(!e.note.trim())continue;const t={};for(const s of e.attach)t[s.fileName]=`/attachment/${s.id}`;e.note=lr(e.note,"img",t)}}fragments(){const e=this.discussionMeta;return st(super.fragments(),{text:e.title,href:this.router.urlForName("freeze-discussion",{course_id:this.courseMeta.id.toString(),discussion_id:e.id.toString()}),active:!0})}renderBody(){return D`${this.discussionJson.posts.items.map((e=>D`<div class="box"><div class="content"><strong>${e.name}</strong> <small>${Le("email")} ${e.email}</small> <small>${Le("calendar_today")} ${e.date}</small><br>${Pe(e.note)} ${e.attach.map(((e,t)=>D`${0===t?D`<br>`:void 0} ${Le("attachment")} <a href="/attachment/${e.id}" target="_blank">${e.srcName}</a>`))}</div></div>`))}`}};xr=e([Z("freeze-discussion")],xr);let Ar=class extends pr{constructor(){super(...arguments),this.menuItem=er,this.body=""}fragments(){var e;const t=super.fragments(),s={course_id:this.courseMeta.id.toString(),homework_id:this.homeworkMeta.id.toString()};return t[t.length-1].active=!1,t.push({text:this.homeworkMeta.title,href:this.router.urlForName("freeze-homework",s),active:!0}),t.push({text:`可下載 (${(null===(e=this.homeworkChildren.submittedhomework)||void 0===e?void 0:e.length)||0})`,href:this.router.urlForName("freeze-homework-submissions",s)}),t}async prepareState(e,t){super.prepareState(e,t),this.homeworkMeta=await dr(e.params,t,"homework"),this.body=await t.getText("homework",this.homeworkMeta.id,"index.html"),this.homeworkChildren=ut(this.homeworkMeta.children)}renderBody(){return Ne(this.body)}};Ar=e([Z("freeze-homework")],Ar);let Sr=class extends Ar{fragments(){const e=super.fragments();return e[e.length-2].active=!1,e[e.length-1].active=!0,e}async prepareState(e,t){await super.prepareState(e,t),this.submissions=await t.getMetas("submittedhomework",this.homeworkChildren.submittedhomework)}fields(){const e=(e,t)=>{const s=this.router.urlForName("freeze-submission",{course_id:this.courseMeta.id.toString(),homework_id:this.homeworkMeta.id.toString(),submittedhomework_id:e.id.toString()});return D`<a href="${s}">${t}</a>`};return{id:e,title:e,by:Xe,comment:(e,t)=>t||"-"}}renderBody(){return void 0===this.submissions||0===this.submissions.length?D`<div style="display:inline-block"><div class="oops">¯\\_(ツ)_/¯</div><div class="has-text-centered">no submissions found</div></div>`:D`<freeze-table .items="${this.submissions}" .fields="${this.fields()}" .sortDescending="${!0}" .sortField="${"id"}"></freeze-table>`}};Sr=e([Z("freeze-homework-submissions")],Sr);let kr=class extends Sr{constructor(){super(...arguments),this.submissionBody=""}fragments(){const e=this.submissionMeta;return st(super.fragments(),{text:e.title,href:this.router.urlForName("freeze-submission",{course_id:this.courseMeta.id.toString(),homework_id:this.homeworkMeta.id.toString(),submittedhomework_id:e.id.toString()}),active:!0})}async prepareState(e,t){await super.prepareState(e,t),this.submissionMeta=await dr(e.params,t,"submittedhomework"),this.submissionBody=await t.getText("submittedhomework",this.submissionMeta.id,"index.html")}renderBody(){return Ne(this.submissionBody)}};kr=e([Z("freeze-submission")],kr);let Cr=class extends Q{constructor(){super(),this.fsAvailable="showDirectoryPicker"in window,this.serviceWorkerStatus=ze,this.serviceWorkerDescription="Unknown",this.extensionInstalled=!1,this.extensionVersion="",this.updatedListener=()=>this.updateExtensionStatus()}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.checkServiceWorkerStatus();document.querySelector("freeze-extension-status").addEventListener("updated",this.updatedListener),this.updateExtensionStatus()}disconnectedCallback(){var e;null===(e=document.querySelector("freeze-extension-status"))||void 0===e||e.removeEventListener("updated",this.updatedListener)}updateExtensionStatus(){const e=document.querySelector("freeze-extension-status");this.extensionInstalled=""!==e.extensionId,this.extensionVersion=e.extensionVersion}async checkServiceWorkerStatus(){for(let e=1;e<100;e*=1.3){const t=await fetch("/sw-status.json");switch((await t.json()).version){case null:this.serviceWorkerStatus=ze,this.serviceWorkerDescription="Unavailable";break;case 1:return this.serviceWorkerStatus=Ue,void(this.serviceWorkerDescription="Active");default:return this.serviceWorkerStatus=Oe,void(this.serviceWorkerDescription="Unknown")}await new Promise((t=>setTimeout(t,1e3*e)))}}render(){return D`<div class="content"><h1 class="title">ilmsfreeze</h1><p>Hello! ilmsfreeze helps you back up & view ${Ie("NTHU iLMS","https://lms.nthu.edu.tw/")} data in the browser.<br></p><p>Source code is hosted on ${Ie("GitHub","https://github.com/afq984/ilmsfreeze")}. Bug reports & contributions welcome!</p>${this.renderDiagnostics()}<h3>Privacy</h3>Your iLMS data stays on your disk and does not go to our server.<br>Google Analytics is used to track site usage.</div>`}renderDiagnostics(){return D`<h3>Diagnostics</h3><dl><dt><strong>File System Access API</strong> ${this.fsAvailable?Be(Ue,"Available"):Be(Te,"Unsupported")}</dt><dd><em>Required</em> to load/download iLMS data from/to your disk.<br>See ${Ie("supported browsers","https://caniuse.com/native-filesystem-api")}.</dd><dt><strong>Service Worker</strong> ${Be(this.serviceWorkerStatus,this.serviceWorkerDescription)}</dt><dd>The service worker provides access to <em>attachments, videos, and inline images</em>.<br>Try close all tabs and reload this site if there is a problem.</dd><dt><strong>Chrome Extension</strong> ${this.extensionInstalled?Be(Ue,`Installed (version: ${this.extensionVersion})`):Be(ze,"Not installed")}</dt><dd>You need the ${Ie("Chrome Extension","https://chrome.google.com/webstore/detail/jmchkngdnmcmenihgjknjoamfdkpojcn")} to <em>download</em> from iLMS.<br>Alternatively, you can use ${Ie("ilmsdump","https://github.com/afq984/ilmsdump")} to backup. ilmsfreeze is compatible with the <code>ilmsdump.out</code> directory.</dd></dl>`}};e([ee()],Cr.prototype,"fsAvailable",void 0),e([ee()],Cr.prototype,"serviceWorkerStatus",void 0),e([ee()],Cr.prototype,"serviceWorkerDescription",void 0),e([ee()],Cr.prototype,"extensionInstalled",void 0),e([ee()],Cr.prototype,"extensionVersion",void 0),Cr=e([Z("freeze-index")],Cr);let Er,Rr;const Mr=new WeakMap,Dr=new WeakMap,Pr=new WeakMap,Lr=new WeakMap,Nr=new WeakMap;let Ir={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return Dr.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Pr.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return zr(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ur(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Rr||(Rr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Tr(this),t),zr(Mr.get(this))}:function(...t){return zr(e.apply(Tr(this),t))}:function(t,...s){const r=e.call(Tr(this),t,...s);return Pr.set(r,t.sort?t.sort():[t]),zr(r)}}function Or(e){return"function"==typeof e?Ur(e):(e instanceof IDBTransaction&&function(e){if(Dr.has(e))return;const t=new Promise(((t,s)=>{const r=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),r()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)}));Dr.set(e,t)}(e),t=e,(Er||(Er=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,Ir):e);var t}function zr(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,s)=>{const r=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(zr(e.result)),r()},i=()=>{s(e.error),r()};e.addEventListener("success",n),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&Mr.set(t,e)})).catch((()=>{})),Nr.set(t,e),t}(e);if(Lr.has(e))return Lr.get(e);const t=Or(e);return t!==e&&(Lr.set(e,t),Nr.set(t,e)),t}const Tr=e=>Nr.get(e);const Br=["get","getKey","getAll","getAllKeys","count"],jr=["put","add","delete","clear"],Hr=new Map;function Fr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Hr.get(t))return Hr.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,n=jr.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!n&&!Br.includes(s))return;const i=async function(e,...t){const i=this.transaction(e,n?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[s](...t),n&&i.done]))[0]};return Hr.set(t,i),i}Ir=(e=>({...e,get:(t,s,r)=>Fr(t,s)||e.get(t,s,r),has:(t,s)=>!!Fr(t,s)||e.has(t,s)}))(Ir);let Wr=class extends Q{constructor(){super(...arguments),this.extensionId="",this.extensionVersion=""}};e([X()],Wr.prototype,"extensionId",void 0),e([X()],Wr.prototype,"extensionVersion",void 0),Wr=e([Z("freeze-extension-status")],Wr);let qr=class extends Q{constructor(){super(),this.mainRef=new we,this.router=new or,this.dbInitDone=this.initDB()}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.initServiceWorker()}async firstUpdated(){await this.dbInitDone,this.router.setOutlet(this.mainRef.value),this.router.setRoutes(ir)}async initDB(){this.db=await function(e,t,{blocked:s,upgrade:r,blocking:n,terminated:i}={}){const o=indexedDB.open(e,t),a=zr(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(zr(o.result),e.oldVersion,e.newVersion,zr(o.transaction))})),s&&o.addEventListener("blocked",(()=>s())),a.then((e=>{i&&e.addEventListener("close",(()=>i())),n&&e.addEventListener("versionchange",(()=>n()))})).catch((()=>{})),a}("meta",1,{upgrade(e){e.createObjectStore("keyval")}});const e=new URLSearchParams(window.location.search).get("open");if("https://ilmsdump.afq984.org"===e)return this.setDataSource(new Qe(e)),void window.history.replaceState("","",window.location.pathname);const t=await this.db.get("keyval","storedSource");if(void 0!==t){const e="FileSystemDataSource"===(s=t).ty?new Ge(s.data):"RemoteDataSource"==s.ty?new Qe(s.data):null;if(null!==e)if(e instanceof Ge){const t=await e.rootHandle.queryPermission({mode:"read"});"granted"===t?this.setDataSource(e,!0):console.log("Bad read perm:",t)}else this.setDataSource(e,!0)}var s}initServiceWorker(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((e=>{console.log("ServiceWorker registration successful with scope: ",e.scope),e.addEventListener("updatefound",(()=>{const t=e.installing;void 0!==this.dataSource&&t.postMessage({op:"set_data_source",data:Ze(this.dataSource)}),null==t||t.postMessage({op:"take_over"})}))}),(e=>{console.log("ServiceWorker registration failed: ",e)}))}render(){return D`<freeze-navbar @subscribe="${this._onSubscribe}" @directory-open="${this._onClick}"></freeze-navbar><div class="section"><main ${$e(this.mainRef)} class="container" @subscribe="${this._onSubscribe}" @request-write="${this._onRequestWrite}"></main></div>`}async _onClick(){const e=await window.showDirectoryPicker();this.setDataSource(new Ge(e))}async _onRequestWrite(){if(void 0!==this.dataSource&&this.dataSource instanceof Ge){const e=this.dataSource.rootHandle;"prompt"===await e.queryPermission({mode:"readwrite"})&&(await e.requestPermission({mode:"readwrite"}),this.setDataSource(this.dataSource))}}setDataSource(e,t=!1){var s;this.dataSource=e;const r={detail:this.dataSource};this.router.dataSource=e,this.dispatchEvent(new CustomEvent("directory-changed",r)),"serviceWorker"in navigator&&null!==navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({op:"set_data_source",data:Ze(e)}):console.log("Service worker not available, not sending data source"),t||null===(s=this.db)||void 0===s||s.put("keyval",Ze(e),"storedSource"),console.log(`set data source: ${e.name}`)}async _onSubscribe(e){await e.detail(this,this.dataSource)}};qr=e([Z("freeze-app")],qr);export{qr as FreezeApp,Wr as FreezeExtensionStatus};
//# sourceMappingURL=freeze-app.js.map
